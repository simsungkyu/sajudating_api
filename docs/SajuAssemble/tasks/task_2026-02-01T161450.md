# Task plan: Verification §7 및 전체 흐름 점검 1회 수행 및 검증 이력 기록 (2026-02-01T161450)

CheckList.md has no remaining incomplete items. Single task chosen from **rest of docs** (Verification.md):

- **Verification.md §7 체크리스트 (1)~(5) 및 전체 흐름 점검을 검증 담당자가 1회 수행한 뒤, 체크박스를 갱신하고 검증 이력 테이블에 결과를 기록한다.**

Ref: PRD.md §6 성공 기준, §7 추가 요청사항; Verification.md §1–§7, 전체 흐름 점검, 검증 이력; OperatorGuide.md; ExtractionAPI.md; Seed.md; TestScope.md.

---

## Scope (interpretation)

- **§7 체크리스트**: Verification.md "PRD §7 (추가 요청사항) 체크리스트" 5항목 — (1) 사주 추출 결과화면 원국 음양 볼드·오행 컬러, (2) 궁합 추출 결과화면 A/B 명식 요약, (3) seed 폴더 참조·9옵션·일괄 등록, (4) 사주 LLM 요청 전체 내용 textarea, (5) 궁합 LLM 요청 전체 내용 textarea.
- **전체 흐름 점검**: Verification.md "전체 흐름 점검" — 사주 추출(인생/연도별/월별/일간/대운) 단계별 체크, 궁합 추출 단계별 체크.
- **자동 검증**: run_verification.sh 또는 `cd api && make test-itemncard && go build .`로 테스트·빌드 통과 확인.
- **산출물**: Verification.md 내 §7 (1)~(5) 체크박스 갱신, 전체 흐름 점검 체크박스 갱신, 검증 이력 테이블에 1행 추가(날짜, 검증자, 결과, 비고·task_2026-02-01T161450 참조). 이슈 발견 시 구체적 수정 또는 별도 태스크로 정리.

---

## Ordered tasks

### 1. 자동 검증 실행 및 통과 확인

- **Goal**: itemNcard 관련 테스트와 빌드가 통과하는지 확인한다. 실패 시 이 태스크 플랜 진행 전에 수정한다.
- **Work**: (a) Repo root에서 `./docs/saju/itemNcard/run_verification.sh` 실행(또는 `cd api && make test-itemncard && go build .`). (b) 출력에서 `make test-itemncard`와 `go build .` 성공 여부 확인. (c) 실패 시 원인 수정 후 재실행하여 통과할 때까지 진행. (d) 통과 시 run_verification.sh가 출력하는 "검증 이력 테이블에 붙여넣을 수 있는 마크다운 한 줄"을 복사해 두거나, 수동으로 동일 형식 행을 준비한다.
- **Scope**: api/ 테스트·빌드만. 코드 변경은 실패 시에만.

---

### 2. §7 (1) 사주 추출 결과화면 — 원국 음양 볼드·오행 컬러

- **Goal**: Verification.md §7 (1) 항목을 1회 수행하고, 충족 시 체크한다.
- **Work**: (a) admweb 로그인 → 데이터 카드 → **사주 추출 테스트** 탭. (b) 생년월일·시간·타임존 입력, 모드 **인생** 선택 후 **실행**. (c) 결과 패널에서 원국(년/월/일/시 기둥)이 **음양 볼드**(양=굵게), **오행 컬러**(목=녹색, 화=빨강, 토=갈색, 금=회색, 수=파랑)로 표시되는지 확인. (d) 충족 시 Verification.md §7 (1) 체크박스를 `[x]`로 갱신. 미충족 시 이슈를 비고에 기록하고 필요 시 별도 수정 태스크로 정리.
- **Scope**: 수동 확인 및 Verification.md 편집만.

---

### 3. §7 (2) 궁합 추출 결과화면 — A/B 명식 요약

- **Goal**: Verification.md §7 (2) 항목을 1회 수행하고, 충족 시 체크한다.
- **Work**: (a) 데이터 카드 → **궁합 추출 테스트** 탭. (b) A/B 생년월일·시간·타임존 입력 후 **실행**. (c) 결과 패널에서 **A 명식**과 **B 명식**이 각각 원국, rule_set, engine_version, items_summary, tokens_summary와 함께 나란히(또는 명확히 구분되어) 표시되는지 확인. (d) 충족 시 Verification.md §7 (2) 체크박스를 `[x]`로 갱신. 미충족 시 이슈 기록 및 필요 시 별도 태스크.
- **Scope**: 수동 확인 및 Verification.md 편집만.

---

### 4. §7 (3) seed 폴더 참조 확인

- **Goal**: Verification.md §7 (3) 항목을 1회 수행하고, 충족 시 체크한다.
- **Work**: (a) Seed.md "Seed 파일 참조 현황"과 docs/saju/itemNcard/seed/ 폴더 대응 관계가 문서화되어 있는지 확인. (b) admweb "시드에서 불러오기" 9개 옵션과 seed/ 파일 대응이 일치하는지 확인. (c) 필요 시 **일괄 등록**으로 나머지 시드 파일을 불러올 수 있는지 확인(선택). (d) 충족 시 Verification.md §7 (3) 체크박스를 `[x]`로 갱신. 미충족 시 이슈 기록 및 필요 시 별도 태스크.
- **Scope**: 문서·UI 확인 및 Verification.md 편집만.

---

### 5. §7 (4) 사주 추출 결과 — LLM 요청 전체 내용 textarea

- **Goal**: Verification.md §7 (4) 항목을 1회 수행하고, 충족 시 체크한다.
- **Work**: (a) 사주 추출 테스트에서 생년월일·모드 입력 후 **실행**. (b) 결과 패널에 "LLM 요청 전체 내용" 접기/펼치기 섹션과 read-only textarea가 있는지 확인. (c) 결과 표시 시(또는 불러오기 시) LLM에 전달되는 전체 텍스트가 textarea에 표시·복사 가능한지 확인. (d) 충족 시 Verification.md §7 (4) 체크박스를 `[x]`로 갱신. 미충족 시 이슈 기록 및 필요 시 별도 태스크.
- **Scope**: 수동 확인 및 Verification.md 편집만.

---

### 6. §7 (5) 궁합 추출 결과 — LLM 요청 전체 내용 textarea

- **Goal**: Verification.md §7 (5) 항목을 1회 수행하고, 충족 시 체크한다.
- **Work**: (a) 궁합 추출 테스트에서 A/B 생년월일 입력 후 **실행**. (b) 결과 패널에 "LLM 요청 전체 내용" 접기/펼치기 섹션과 read-only textarea가 있는지 확인. (c) 불러오기 시 LLM에 전달되는 전체 텍스트가 표시·복사 가능한지 확인. (d) 충족 시 Verification.md §7 (5) 체크박스를 `[x]`로 갱신. 미충족 시 이슈 기록 및 필요 시 별도 태스크.
- **Scope**: 수동 확인 및 Verification.md 편집만.

---

### 7. 전체 흐름 점검 — 사주 추출

- **Goal**: Verification.md "전체 흐름 점검" 사주 추출(인생/연도별/월별/일간/대운) 5모드를 1회씩 수행하고, 각 단계 체크박스를 갱신한다.
- **Work**: (a) **인생 모드**: 사주 추출 테스트 탭 이동 → 생년월일·시간·타임존·모드 인생 → 실행 → 결과 패널(원국 음양·오행, items/tokens, 선택 카드·evidence, LLM textarea) 확인 → 해당 체크박스들 갱신. (b) **연도별**: 모드 연도별, 대상 연도(예: 2025) 입력 후 실행 → 결과 확인 → 체크박스 갱신. (c) **월별**: 모드 월별, 대상 연·월(예: 2025-03) 입력 후 실행 → 결과 확인 → 체크박스 갱신. (d) **일간**: 모드 일간, 대상 연·월·일(예: 2025-03-15) 입력 후 실행 → 결과·연계 만세력 확인 → 체크박스 갱신. (e) **대운**: 모드 대운, 대운 단계(0)·성별 입력 후 실행 → 결과·연계 만세력 확인 → 체크박스 갱신. (f) 미충족 단계가 있으면 비고에 기록.
- **Scope**: 수동 확인 및 Verification.md "전체 흐름 점검" 사주 섹션 체크박스 편집만.

---

### 8. 전체 흐름 점검 — 궁합 추출

- **Goal**: Verification.md "전체 흐름 점검" 궁합 추출 단계를 1회 수행하고, 체크박스를 갱신한다.
- **Work**: (a) 데이터 카드 → 궁합 추출 테스트 탭 이동. (b) A/B 생년월일·시간·타임존 입력 후 **실행**. (c) 결과 패널에서 A 명식·B 명식 요약, P_tokens 요약, 선택된 궁합 카드(카드 ID, score, evidence), LLM 요청 전체 내용 textarea 확인. (d) 충족 시 "궁합 추출 흐름" 하위 체크박스들을 `[x]`로 갱신. 미충족 시 이슈 기록.
- **Scope**: 수동 확인 및 Verification.md 궁합 흐름 체크박스 편집만.

---

### 9. §2 체크리스트 갱신(선택)

- **Goal**: Verification.md §2 "사주 추출 테스트"·"궁합 추출 테스트" 체크박스를, 위 7·8 수행 결과에 따라 갱신한다.
- **Work**: (a) §7 및 전체 흐름 점검이 모두 충족된 경우, §2의 "사주 추출 테스트" 및 "궁합 추출 테스트" 항목을 `[x]`로 갱신. (b) 일부만 충족된 경우에는 §2는 갱신하지 않거나, 비고에 "일부 확인" 등으로 기록한다.
- **Scope**: Verification.md §2 체크박스만. 선택 사항.

---

### 10. 검증 이력 테이블에 1행 추가

- **Goal**: Verification.md "검증 이력 (Execution log)" 테이블에 이번 1회 수행 결과를 기록한다.
- **Work**: (a) 테이블 형식에 맞춰 한 행을 추가한다. (b) **날짜**: 수행일(예: 2026-02-01). **검증자**: 담당자 이름 또는 "(task 실행)". **결과**: 통과 / 미통과 / §7(1)~§7(5)·전체 흐름 통과 등 요약. **비고**: task_2026-02-01T161450 참조, 및 §7·전체 흐름 중 미충족 항목이나 이슈가 있으면 간단히 기재. (c) Verification.md 하단 "항목별 기록용 템플릿"이 있으면 참고하여 결과를 요약해 넣을 수 있다.
- **Scope**: Verification.md 검증 이력 테이블 편집만.

---

## Summary

| Step | Description |
|------|-------------|
| 1 | 자동 검증: run_verification.sh 또는 make test-itemncard + go build 실행, 통과 확인 |
| 2 | §7 (1): 사주 추출 결과화면 원국 음양 볼드·오행 컬러 확인, 체크 갱신 |
| 3 | §7 (2): 궁합 추출 결과화면 A/B 명식 요약 확인, 체크 갱신 |
| 4 | §7 (3): seed 폴더 참조·9옵션·일괄 등록 확인, 체크 갱신 |
| 5 | §7 (4): 사주 LLM 요청 전체 내용 textarea 확인, 체크 갱신 |
| 6 | §7 (5): 궁합 LLM 요청 전체 내용 textarea 확인, 체크 갱신 |
| 7 | 전체 흐름: 사주(인생/연도별/월별/일간/대운) 5모드 점검, 체크 갱신 |
| 8 | 전체 흐름: 궁합 추출 점검, 체크 갱신 |
| 9 | §2 체크리스트 갱신(선택) |
| 10 | 검증 이력 테이블에 1행 추가(task_2026-02-01T161450, 결과·비고) |

---

## References

- **Verification.md**: §1–§3 체크리스트, §7 (1)~(5), 전체 흐름 점검, 검증 이력, run_verification.sh 안내.
- **PRD.md**: §6 성공 기준, §7 추가 요청사항.
- **OperatorGuide.md**: 데이터 카드 메뉴, 사주/궁합 추출 테스트, 생일·시간 입력 규칙.
- **ExtractionAPI.md**: 사주/궁합 추출 테스트 요청·응답, llm_context.
- **Seed.md**: Seed 파일 참조 현황, 9개 옵션, 일괄 등록.
- **TestScope.md**: make test-itemncard 범위, 수동 검증 항목.

---

## Execution result (2026-02-01)

### Done

- **Task 1 — 자동 검증**: `run_verification.sh` 실행. 초기 실패 원인 수정 후 통과.
  - **원인 1**: `TestRunSajuExtractTest_IlganMode`에서 DB 미초기화 시 `SelectSajuCards` → `dao.NewItemNCardRepository()`가 nil DB로 패닉. **수정**: `service/itemncard/saju.go`·`pair.go`의 `SelectSajuCards`/`SelectPairCards`에서 `dao.GetDB() == nil`이면 에러 반환(패닉 대신), 테스트는 기존대로 500 시 `t.Skip`.
  - **원인 2**: `admgql.resolvers.go`에서 `ptrToStr` 미정의로 `go build` 실패. **수정**: `api/utils/utils.go`에 `PtrToStr(*string) string` 추가, resolvers에서 `utils.PtrToStr` 사용.
- **검증 이력**: Verification.md 검증 이력 테이블에 1행 추가 (날짜 2026-02-01, 결과 통과, 비고 task_2026-02-01T161450).

### Status

- **자동 검증**: 통과 (`make test-itemncard` + `go build .` 성공).
- **§7 (1)~(5) 및 전체 흐름 점검**: 수동 확인 항목. 검증 담당자가 admweb에서 1회 수행한 뒤 Verification.md §7 체크박스 및 전체 흐름 체크박스를 갱신하고, 필요 시 검증 이력에 항목별 결과를 추가할 것.

### Remaining / next steps

1. **검증 담당자**: Verification.md §7 (1)~(5) 및 전체 흐름 점검을 1회 수행 후, 해당 체크박스를 `[x]`로 갱신하고 항목별 이슈가 있으면 비고 또는 별도 태스크로 정리.
2. (선택) §2 "사주 추출 테스트"·"궁합 추출 테스트" 체크박스는 위 수동 점검 모두 충족 시 `[x]`로 갱신.
3. CheckList.md: 본 태스크는 Verification.md §7·전체 흐름에서 선정된 항목이며, CheckList.md에는 미완료 항목이 없어 변경 없음.
