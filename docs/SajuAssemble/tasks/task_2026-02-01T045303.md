# Task plan: itemNcard next steps (2026-02-01T045303)

Single task plan listing the next concrete, ordered tasks for itemNcard implementation. Ref: PRD.md, CardDataStructure.md, ChemiStructure.md, TokenRule.md, TokenStructure.md, UserInfoStructure.md. Each task is one step of appropriate size (neither too large nor too small). Only create or update this plan; do not implement code yet.

---

## Execution result (2026-02-01)

**Status:** All 6 tasks implemented. Backend unchanged (frontend + docs only).

| Task | Done | Summary |
|------|------|---------|
| 1 | ✅ | **원국 표시 개선**: Added `admweb/src/components/PillarDisplay.tsx` — 양(陽) stems/branches bold, 오행(목/화/토/금/수) colors. Saju 추출 테스트 결과에 "원국 (양=볼드, 오행=컬러)" 섹션과 `PillarsDisplay` 사용. |
| 2 | ✅ | **A/B 명식 요약**: Pair 추출 테스트 결과에 "A 명식" / "B 명식" 두 개의 Paper 섹션(원국, rule_set, engine_version, items_summary, tokens_summary) 나란히 표시. |
| 3 | ✅ | **Seed 참조 문서화**: `docs/saju/itemNcard/Seed.md`에 "Seed 파일 참조 현황" 추가 — 6개 시드에서 불러오기 옵션 ID ↔ seed 파일 매핑, Seed.md 언급 파일, UI 미참조 파일 안내. |
| 4 | ✅ | **사주 LLM textarea**: 사주 추출 테스트 결과 패널에 "LLM 요청 전체 내용" 접기/펼치기 + read-only TextField(불러오기 버튼으로 `POST /api/adm/llm_context_preview` 호출 후 표시). |
| 5 | ✅ | **궁합 LLM textarea**: 동일 패턴으로 궁합 추출 테스트 결과 패널에 "LLM 요청 전체 내용" 접기/펼치기 + read-only TextField. |
| 6 | ✅ | **PRD §7 체크리스트**: `docs/saju/itemNcard/Verification.md`에 "PRD §7 (추가 요청사항) 체크리스트" 5항목 추가. |

**Verification:** Run from repo root: `cd api && go test ./...` and `go build .` (or `make test-itemncard`) to confirm backend; `cd admweb && npm run build` for frontend. Dev server and gqlgen are not started by this plan.

**Remaining / next steps:** None for this plan. PRD §7 체크리스트 항목은 운영에서 실제 화면 확인 후 체크하면 됨.

---

## Current state (as of 2026-02-01)

- **Backend**: Card CRUD (GraphQL), soft delete, extraction test REST (saju: 인생/연도별/월별, pair). itemncard pipeline: pillars → items → tokens → card selection with evidence, domain/tag limits, cooldown_group, max_per_user. LLM context builder and POST `/api/adm/llm_context_preview`. AdminExtractService returns user/pair info + selected cards with evidence and score. y2sl-local MCP: `register_card`, `update_card`, `list_cards` in mcplocal/cardtools.go.
- **admweb**: Data Cards page with tabs (사주 카드, 궁합 카드, 사주 추출 테스트, 궁합 추출 테스트). List with filters (scope, status, category, tags, rule_set, domain, cooldown_group, 삭제 포함), sort, paging. Create/edit with full schema and trigger/score JSON validation (pair: src P|A|B). Soft delete, 복제, JSON 내보내기, 시드에서 불러오기 (6 options), 일괄 등록. Extract result: items/tokens summary, pillars, selected cards + expandable evidence; copy-to-clipboard; LLM 컨텍스트 미리보기 (dialog); JSON 저장.
- **Docs**: ExtractionAPI.md, Seed.md, OperatorGuide.md, Verification.md, 연도별_월별_pillar.md, run_verification.sh. PRD §6 success criteria met. PRD §7 (추가 요청사항) partially addressed; remaining items below.

---

## Ordered next tasks

### 1. Saju extraction result: 원국 표시 개선 (음양 볼드, 오행 컬러)

- In the **사주 추출 테스트** result panel, display user **원국(pillars)** and related 명식 정보 in a form similar to typical saju services (PRD §7): **양(陽)** stems/characters in **bold**; **오행(五行)** with distinct colors (e.g. 목=green, 화=red, 토=yellow/brown, 금=white/gray, 수=blue/black or project palette). Apply to pillars display (년/월/일/시 기둥) and any item/token summary that shows 오행 or 간지. Frontend-only; no backend change. Keep scope to styling and layout of existing data.

---

### 2. Pair extraction result: A/B 명식 분석 정보 요약 표시

- In the **궁합 추출 테스트** result panel, ensure **A 명식 분석 정보** and **B 명식 분석 정보** are clearly shown (PRD §7): pillars, items/tokens summary (or rule_set, engine_version) for each person. If the API already returns `summary_a` / `summary_b` and the UI shows them in a compact form, enhance visibility (e.g. two side-by-side or stacked sections with labels "A 명식", "B 명식"). Align with UserInfoStructure and ExtractionAPI response shape. Small UX change; backend change only if summaries are missing or need to be extended.

---

### 3. Seed folder reference verification and documentation

- **Verify** that seed files in `docs/saju/itemNcard/seed/` are referenced where intended (PRD §7 "seed 폴더 내의 파일이 참조되는지 확인 필요"). Document: (1) which seed files are used by **시드에서 불러오기** in admweb (currently `admweb/src/data/seedCards.ts` — list the 6 option IDs and corresponding seed file names); (2) which seed files are documented in Seed.md; (3) which files in `seed/` are **not** referenced by the UI (list or count). Optionally add 1–2 more seed options to the UI to reference additional seed files (e.g. from seed/), or document the gap and leave as future work. Update Seed.md or OperatorGuide with a short "Seed 파일 참조 현황" subsection. No change to backend API.

---

### 4. Saju extraction result: LLM 요청 전체 내용 textarea

- In the **사주 추출 테스트** result panel, add a **textarea** that shows the **full content that would be sent to the LLM** (PRD §7 "종합하여 llm에 요청되어야 하는 전체 내용에 대해 textarea 내에 표시"). Reuse the same data as the existing "LLM 컨텍스트 미리보기" (e.g. call `POST /api/adm/llm_context_preview` with the current result’s selected card uids, or include the built context in the extraction response and display it). The textarea should be in the result panel (inline or expandable), read-only, so operators can see/copy the exact LLM request body. One textarea per saju result; no new backend contract if preview API is reused.

---

### 5. Pair extraction result: LLM 요청 전체 내용 textarea

- Same as task 4 for **궁합 추출 테스트**: add a **textarea** in the result panel that shows the **full content that would be sent to the LLM** (PRD §7). Reuse the pair extraction’s selected cards and existing LLM context preview (or equivalent) so the textarea displays the combined context for the pair. One textarea per pair result. Keep implementation consistent with task 4 (shared component or pattern if applicable).

---

### 6. Verification: PRD §7 checklist

- In `docs/saju/itemNcard/Verification.md` (or OperatorGuide), add a short **PRD §7 (추가 요청사항)** checklist so that sign-off can record completion of: (1) 사주 추출 결과화면 — 원국 등 여타 사주서비스 형태 표시 (음양 볼드, 오행 컬러); (2) 궁합 추출 결과화면 — A/B 명식 분석 정보 요약 표시; (3) seed 폴더 참조 확인; (4) 사주 추출 결과 — LLM 요청 전체 내용 textarea; (5) 궁합 추출 결과 — LLM 요청 전체 내용 textarea. Documentation only; no code.

---

## Reference

| Doc | Use |
|-----|-----|
| PRD.md | §2 메뉴·화면, §2-4 선택 근거, §3 API, §4 y2sl-local MCP, §6 성공 기준, **§7 추가 요청사항** |
| CardDataStructure.md | Card JSON, trigger (all/any/not), score, content |
| ChemiStructure.md | P_tokens, pair card schema, src P\|A\|B |
| TokenRule.md | items → tokens, where 정규화, L/M/H |
| TokenStructure.md | Token 문법, 카테고리, 위치 표준 |
| UserInfoStructure.md | user input, pillars, items[], tokens[], rule_set, engine_version |
| ExtractionAPI.md | REST contract for extraction test and LLM preview |
| Verification.md | PRD §6 checklist, 검증 이력 |
| Seed.md | Seed file list, GraphQL/admweb load steps |

---

## Notes

- Tasks 1–2 address PRD §7 display (원국 표시, A/B 명식 요약). Tasks 3–5 address seed 참조 and LLM textarea. Task 6 is documentation for §7 sign-off.
- Run all commands from repo root; backend from `api/` (e.g. `cd api && make test-itemncard`).
- Implementation completed 2026-02-01; see Execution result above.
