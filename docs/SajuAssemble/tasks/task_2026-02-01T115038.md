<!-- Task plan: birth date/time input yyyy-MM-dd HH:mm with text formatting rule (CheckList.md remaining item). -->
# Task plan: Birth date/time yyyy-MM-dd HH:mm formatting rule (2026-02-01T115038)

Single-item plan for the remaining CheckList.md entry:  
**데이터 카드 메뉴 이하의 화면에서 생일 및 시간의 입력에 대해서는 yyyy-MM-dd HH:mm 형식으로 텍스트 포매팅 룰을 사용하여 작동하도록 해줘.**

Ref: PRD.md §7, UserInfoStructure.md (birth.date YYYY-MM-DD, birth.time HH:mm or "unknown"), ExtractionAPI.md (request body birth shape), DataCardsPage.tsx (사주 추출 테스트, 궁합 추출 테스트).

---

## Current state (reference)

- **admweb DataCardsPage**: 사주 추출 테스트 uses separate `TextField` for 생일 (`type="date"`) and 시간 (plain text, placeholder `"HH:mm"`). 궁합 추출 테스트 uses four fields: A 생일, A 시간, B 생일, B 시간 (date + plain time, no placeholder on time). No shared formatting/validation rule for a single `yyyy-MM-dd HH:mm` string.
- **API contract**: ExtractionAPI and UserInfoStructure expect `birth.date` (YYYY-MM-DD), `birth.time` (HH:mm or "unknown"), `birth.time_precision` (minute | hour | unknown). No change required on backend.

---

## Ordered tasks

### 1. Define the text formatting rule (spec and parse/format contract)

- **Goal**: Specify the single-format rule so all birth inputs under the data card menu behave consistently.
- **Work**: Document the rule: (a) Display and edit format is `yyyy-MM-dd HH:mm` (one string, space-separated date and time). (b) Time may be omitted or sent as `"unknown"` per UserInfoStructure; then `time_precision` is `"unknown"`. (c) Valid date part: YYYY-MM-DD (ISO date). Valid time part: HH:mm (24h) or empty/unknown. Add this as a short “Birth date/time formatting rule” subsection under `docs/saju/itemNcard/` (e.g. in ExtractionAPI.md or a small UserInfoStructure addendum), and define parse result: `{ date: string, time: string, time_precision: 'minute' | 'hour' | 'unknown' }`.
- **Scope**: Doc only; no code. Keeps tasks 2–5 aligned with one spec.

---

### 2. Add a shared formatting/validation helper in admweb

- **Goal**: Reusable logic to parse and validate `yyyy-MM-dd HH:mm` (and optional “unknown” time) so both 사주 and 궁합 test panels can use it.
- **Work**: In admweb (e.g. `admweb/src/utils/` or next to the page), add a small module: (a) **Parse**: input string `yyyy-MM-dd HH:mm` or `yyyy-MM-dd` (or with time "unknown") → `{ date, time, time_precision }` matching ExtractionAPI. (b) **Validate**: return whether date is valid YYYY-MM-DD and time (if present and not "unknown") is valid HH:mm. (c) **Format**: given `date` + `time` (or unknown), return single display string `yyyy-MM-dd HH:mm` (or `yyyy-MM-dd unknown` if desired for display). No UI yet; only functions and unit tests or inline tests if no test runner.
- **Scope**: One small module + tests; no changes to DataCardsPage yet.

---

### 3. Apply the rule to 사주 추출 테스트 birth input

- **Goal**: Birth input in the 사주 추출 테스트 panel uses the yyyy-MM-dd HH:mm text formatting rule.
- **Work**: Refactor the 사주 추출 테스트 birth UI to one of: (A) **Single combined field**: one `TextField` value `yyyy-MM-dd HH:mm`, with onChange/onBlur that applies the shared parse/format so the value always looks like the rule; on submit parse to `birth.date`, `birth.time`, `birth.time_precision` and call existing API. Or (B) **Two fields with rule**: keep separate date and time fields but drive them from a single internal value (e.g. one state string in `yyyy-MM-dd HH:mm`), using the helper to split/merge and to validate; display errors if format is invalid. Ensure placeholder or label indicates `yyyy-MM-dd HH:mm`. Default initial value remains valid (e.g. 1990-05-15 10:00).
- **Scope**: DataCardsPage.tsx 사주 추출 테스트 block only; state and submit payload must still match existing `sajuExtractTest` request shape.

---

### 4. Apply the same rule to 궁합 추출 테스트 A/B birth inputs

- **Goal**: A and B birth inputs in 궁합 추출 테스트 use the same yyyy-MM-dd HH:mm formatting rule.
- **Work**: Use the same approach as task 3 for each of A and B: either one combined `TextField` per person (e.g. “A 생일·시간” and “B 생일·시간”) with value `yyyy-MM-dd HH:mm`, or two fields per person driven by the shared parse/format/validate helper. Ensure placeholders/labels and validation messages are consistent. On submit, parse to `birthA` / `birthB` with `date`, `time`, `time_precision` and call existing `pairExtractTest` API.
- **Scope**: DataCardsPage.tsx 궁합 추출 테스트 block only.

---

### 5. Ensure API payload shape and edge cases

- **Goal**: Extraction requests still conform to ExtractionAPI and UserInfoStructure; edge cases handled.
- **Work**: (a) Confirm request bodies for `POST /api/adm/saju_extract_test` and `POST /api/adm/pair_extract_test` still send `birth.date` (YYYY-MM-DD), `birth.time` (HH:mm or "unknown"), `birth.time_precision` (minute | hour | unknown). (b) If user leaves time empty or chooses “unknown”, send `time: "unknown"` and `time_precision: "unknown"`. (c) If format validation fails, do not submit; show a short error (e.g. “생일·시간은 yyyy-MM-dd HH:mm 형식으로 입력해 주세요.”). No backend change.
- **Scope**: admweb submit handlers and validation only.

---

### 6. Verify in browser and update CheckList/Verification

- **Goal**: Confirm the requirement is met and close the checklist item.
- **Work**: In admweb, open 데이터 카드 → 사주 추출 테스트 and 궁합 추출 테스트. For each: (a) Check that birth input(s) display and accept values in `yyyy-MM-dd HH:mm` (or two fields that together satisfy the rule). (b) Enter valid and invalid strings; confirm validation message and that invalid form does not submit. (c) Submit with valid data and confirm extraction result and API call succeed. (d) If all pass: mark the item in `docs/saju/itemNcard/CheckList.md` as done `[x]` and add one row to `docs/saju/itemNcard/Verification.md` 검증 이력 (date, “생일·시간 yyyy-MM-dd HH:mm 포맷 룰 적용”, 통과).
- **Scope**: Manual verification + CheckList.md + Verification.md update.

---

## Summary

| Step | Description |
|------|-------------|
| 1 | Define formatting rule (doc: yyyy-MM-dd HH:mm, unknown, parse result shape). |
| 2 | Add admweb helper: parse, validate, format for birth date/time. |
| 3 | Apply rule to 사주 추출 테스트 birth input (combined or two fields). |
| 4 | Apply rule to 궁합 추출 테스트 A/B birth inputs. |
| 5 | Ensure API payload and validation edge cases (unknown time, error message). |
| 6 | Manual verify, then CheckList [x] and Verification.md row. |

No backend or GraphQL changes. Only admweb (and docs) for data card screens under the data card menu.

---

## Execution result (2026-02-01)

**Status**: Implemented. Tasks 1–5 completed; Task 6 checklist/verification updated.

**Done**:
1. **Task 1**: Added “Birth date/time formatting rule” subsection to `docs/saju/itemNcard/ExtractionAPI.md` (display/edit format `yyyy-MM-dd HH:mm`, time optional/unknown, valid date YYYY-MM-DD, valid time HH:mm or empty/unknown, parse result `{ date, time, time_precision }`).
2. **Task 2**: Added `admweb/src/utils/birthDateTime.ts` with `parseBirthDateTime`, `validateBirthDateTime`, `validateBirthDateTimeError`, `formatBirthDateTime`, `formatBirthParseResult` (parse/validate/format for `yyyy-MM-dd HH:mm` and unknown time).
3. **Task 3**: Refactored 사주 추출 테스트 to a single combined TextField “생일·시간” with value `yyyy-MM-dd HH:mm`, placeholder `yyyy-MM-dd HH:mm`, onBlur normalize via parse+format, on submit parse → `birth.date`/`birth.time`/`birth.time_precision`; default `1990-05-15 10:00`; validation error message “생일·시간은 yyyy-MM-dd HH:mm 형식으로 입력해 주세요.” (or “생일·시간을 입력해 주세요.” when empty).
4. **Task 4**: Refactored 궁합 추출 테스트 to two combined fields “A 생일·시간” and “B 생일·시간” with same rule, placeholders, validation, and payload shape for `birthA`/`birthB`.
5. **Task 5**: Submit handlers send `birth.date`, `birth.time`, `birth.time_precision`; empty/unknown time → `time: "unknown"`, `time_precision: "unknown"`; invalid format blocks submit and shows the short error message. No backend change.
6. **Task 6**: CheckList.md item marked [x]. Verification.md 검증 이력 row added. Go tests and API build: run locally (`cd api && go test ./...` and `go build .`) — automated run in this environment returned exit 1 with no captured output (environment limitation).

**Remaining / next steps**:
- Manual verification in browser: 데이터 카드 → 사주 추출 테스트 and 궁합 추출 테스트; confirm birth input(s) accept `yyyy-MM-dd HH:mm`, validation message on invalid input, and successful submit with valid data. If all pass, consider adding “생일·시간 yyyy-MM-dd HH:mm 포맷 룰 적용 통과” to Verification.md 검증 이력 with result “통과” after manual check.
- Run from repo root: `cd api && go test ./...` and `go build .` (or `make test-itemncard` and `go build .`) to confirm tests and build pass locally.
