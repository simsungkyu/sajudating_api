# Task plan: Verification §2 — 사주·궁합 추출 테스트 결과 화면 확인 (2026-02-01T124056)

Single-item plan chosen from **docs/saju/itemNcard** (CheckList.md has no remaining items):  
**Verification.md §2** — "사주(인생/연도별/월별)·궁합 '추출 테스트' 실행 후, 결과 화면에서 유저 명식 분석 정보와 선택된 데이터 카드 목록(및 선택 근거) 확인 가능". Unchecked: (1) 사주 추출 테스트 — 결과 패널에서 유저 명식 분석 정보(pillars, items/tokens 요약, rule_set), 선택된 사주 카드 목록(카드 ID, title, score, evidence 토큰) 확인; (2) 궁합 추출 테스트 — 결과 패널에서 A/B 명식 요약, P_tokens 요약, 선택된 궁합 카드 목록(카드 ID, title, score, evidence) 확인.

Ref: PRD.md §2-3·§2-4, Verification.md §2, OperatorGuide.md §사주 추출 테스트·§궁합 추출 테스트, ExtractionAPI.md.

---

## Current state (reference)

- **Verification.md §2**: Two checklist items unchecked — 사주 추출 테스트, 궁합 추출 테스트. 검증 방법: 데이터 카드 → 사주 추출 테스트 / 궁합 추출 테스트 탭에서 실행 후, 결과에 명식 정보와 선택 카드(및 선택 근거)가 표시되는지 확인 (OperatorGuide §사주 추출 테스트, §궁합 추출 테스트 참고).
- **OperatorGuide.md**: 사주 추출 테스트 — 생년월일·시간·모드 입력, 실행 후 명식 정보(pillars, items, tokens 요약), 선택된 사주 카드(score, evidence). 궁합 추출 테스트 — A/B 생년월일·시간 입력, 실행 후 A/B 명식 요약, P_tokens 요약, 선택된 궁합 카드(score, evidence).
- **ExtractionAPI.md**: SajuExtractTestResponse (user_info, selected_cards with evidence, llm_context). PairExtractTestResponse (summary_a, summary_b, p_tokens_summary, selected_cards with evidence, llm_context).

---

## Ordered tasks

### 1. Run automated verification (prerequisite)

- **Goal**: Ensure backend tests and build pass before manual UI verification.
- **Work**: From repo root run `./docs/saju/itemNcard/run_verification.sh` (or `cd api && make test-itemncard && go build .`). If either step fails, fix the failure or record the issue and stop; do not proceed to UI checks until automated verification passes. If pass, note "통과" for use in the final verification log row.
- **Scope**: Command run only; no doc edit in this step.

---

### 2. Verify 사주 추출 테스트 result panel

- **Goal**: Confirm that after running 사주 추출 테스트, the result panel shows user 명식 분석 정보 and selected saju cards with evidence.
- **Work**: (a) In admweb open **데이터 카드** → **사주 추출 테스트** tab. (b) Enter birth date/time (e.g. yyyy-MM-dd HH:mm), timezone, and mode (**인생** or 연도별 or 월별; if 연도별/월별, enter target year/month). (c) Click **실행**. (d) In the result panel confirm: **유저 명식 분석 정보** — pillars (년/월/일/시 기둥), items/tokens 요약, rule_set, engine_version; **선택된 사주 카드 목록** — at least card_id, title, score, and **evidence** (trigger tokens that caused selection). If ENV=dev and no cards are in DB, ensure seed is used per Seed.md and retry or note "seed 모드 확인". (e) Note one-line pass/fail (e.g. "pillars·items·tokens·선택 카드·evidence 표시 확인" or "이슈: …").
- **Scope**: Manual check only. If a defect is found, record it for a separate fix task; do not implement code in this plan.

---

### 3. Verify 궁합 추출 테스트 result panel

- **Goal**: Confirm that after running 궁합 추출 테스트, the result panel shows A/B 명식 요약, P_tokens 요약, and selected pair cards with evidence.
- **Work**: (a) In admweb open **데이터 카드** → **궁합 추출 테스트** tab. (b) Enter A and B birth date/time (yyyy-MM-dd HH:mm each), timezone. (c) Click **실행**. (d) In the result panel confirm: **A 명식 요약** and **B 명식 요약** (pillars, rule_set, engine_version, items_summary, tokens_summary or equivalent); **P_tokens 요약** (궁합 상호작용); **선택된 궁합 카드 목록** — card_id, title, score, **evidence**. If ENV=dev, ensure seed/ is used per Seed.md if needed. (e) Note one-line pass/fail.
- **Scope**: Manual check only. If a defect is found, record it for a separate fix task.

---

### 4. Mark Verification.md §2 checklist and add verification log row

- **Goal**: Close Verification.md §2 and record the outcome in the verification history.
- **Work**: (a) In `docs/saju/itemNcard/Verification.md`, in §2 "사주(인생/연도별/월별)·궁합 '추출 테스트' 실행 후…", set the two checklist items to `- [x]` (사주 추출 테스트, 궁합 추출 테스트) if both tasks 2 and 3 passed. If either failed, leave the failed item as `- [ ]` and add a one-line note of the issue next to it. (b) In the **검증 이력 (Execution log)** table, add one row: date (e.g. 2026-02-01), 검증자 (e.g. 검증자 or task 실행), 결과 (e.g. "§2 사주·궁합 추출 테스트 결과 패널 확인 통과" or "§2 사주 통과, 궁합 이슈: …"), 비고 (e.g. "task_2026-02-01T124056"). Use the 항목별 기록용 템플릿 in Verification.md if recording per-item results.
- **Scope**: Verification.md only; checkboxes and one new table row.

---

## Summary

| Step | Description |
|------|-------------|
| 1 | Run automated verification (run_verification.sh or make test-itemncard + go build); proceed only if pass. |
| 2 | Verify 사주 추출 테스트: result panel shows 명식 정보 (pillars, items/tokens, rule_set) and selected cards with evidence. |
| 3 | Verify 궁합 추출 테스트: result panel shows A/B 명식 요약, P_tokens 요약, selected cards with evidence. |
| 4 | Mark Verification.md §2 checklist (사주·궁합 두 항목) and add one row to 검증 이력. |

Only create or update this task plan file; do not implement code. Verification is manual per OperatorGuide.md and Verification.md §2. If defects are found, record them for separate fix tasks.

---

## Execution result (2026-02-01)

| Step | Status | Notes |
|------|--------|--------|
| 1. Run automated verification | **미실행(출력 미캡처)** | From repo root ran `bash docs/saju/itemNcard/run_verification.sh` and separately `cd api && go test ./types/itemncard/... ./service/... ./mcplocal/... -count=1` and `go build .`. Exit code 1 with no stdout/stderr captured (environment limitation). **로컬에서 `cd api && make test-itemncard && go build .` 실행 권장.** |
| 2. Verify 사주 추출 테스트 result panel | **미수행** | Chrome DevTools MCP: browser already running (userDataDir conflict). 수동 확인: 데이터 카드 → 사주 추출 테스트 탭에서 실행 후 결과 패널에 pillars·items/tokens·rule_set·선택 사주 카드·evidence 표시 여부 확인 권장. |
| 3. Verify 궁합 추출 테스트 result panel | **미수행** | 동일 사유로 MCP 미사용. 수동 확인: 데이터 카드 → 궁합 추출 테스트 탭에서 A/B 명식 요약·P_tokens 요약·선택 궁합 카드·evidence 표시 여부 확인 권장. |
| 4. Mark Verification.md §2 and add log row | **완료** | §2 체크리스트는 사주·궁합 둘 다 수동 검증 미완료로 **유지([ ])**. 검증 이력에 1행 추가: "§2 사주·궁합 추출 테스트 결과 패널 확인 대기" (task_2026-02-01T124056). |

**Remaining / Next steps**

- 로컬에서 `cd api && make test-itemncard && go build .` 실행하여 자동 검증 통과 여부 확인.
- 검증 담당자가 admweb에서 사주 추출 테스트·궁합 추출 테스트 각 1회 실행 후 결과 패널(명식 정보·선택 카드·evidence) 확인.
- 둘 다 통과 시 Verification.md §2의 두 항목을 `- [x]`로 변경하고, 검증 이력에 "§2 사주·궁합 추출 테스트 결과 패널 확인 통과" 행 추가.
