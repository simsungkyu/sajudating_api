<!-- Task plan: DataCardsPage separable components → pages/datacards/ (CheckList). -->
# Task plan: DataCardsPage 컴포넌트를 pages/datacards/ 폴더로 분리 (2026-02-01T120955)

Single-item plan chosen from **CheckList.md** (remaining incomplete item):  
**DataCardsPage.tsx 파일에서 분리할수 있는 컴포넌트를 pages/datacards/ 폴더에 분리해줘.**

Ref: PRD.md §2 (admweb 메뉴·화면), OperatorGuide.md (데이터 카드 메뉴), CardDataStructure.md, ChemiStructure.md, `admweb/src/pages/DataCardsPage.tsx`.

---

## Current state (reference)

- **CheckList.md**: Two remaining items; this plan addresses the first (DataCardsPage 컴포넌트 분리).
- **DataCardsPage.tsx**: Single large file (~970 lines) containing: tab type and default input; pure helpers (cardToInput, duplicateToInput, buildCardExportJson, parseJsonSafe, downloadCardAsJson, validateTriggerJson, validateScoreJson, validateCardInput, seedCardToInput, parseBulkCardItem); **CardFormDialog**; **CardList** (with bulk-import dialog); **CardListFilters**; **SajuExtractTestTab**; **PairExtractTestTab**; **DataCardsPage** (tabs + filter/list state). App.tsx imports `DataCardsPage` from `./pages/DataCardsPage` and routes `/data-cards` to it.

---

## Ordered tasks

### 1. Create datacards folder and extract card utils and types

- **Goal**: 공통으로 쓰이는 카드 관련 순수 함수·타입을 한 모듈로 모아, 이후 컴포넌트 분리 시 재사용할 수 있게 한다.
- **Work**: (a) `admweb/src/pages/datacards/` 디렉터리를 생성한다. (b) `defaultInput`, `cardToInput`, `duplicateToInput`, `buildCardExportJson`, `parseJsonSafe`, `downloadCardAsJson`, `validateTriggerJson`, `validateScoreJson`, `validateCardInput`, `seedCardToInput`, `parseBulkCardItem` 및 이들과 함께 쓰이는 타입(예: `TabValue`는 페이지에서만 쓰이므로 제외 가능)을 `admweb/src/pages/datacards/cardFormUtils.ts`(또는 `utils.ts`) 하나의 파일로 옮긴다. (c) 필요한 import는 GraphQL generated, `../data/seedCards`(SeedCardData), `ItemNCardInput`, `ItemnCardBasicFragment` 등 기존 DataCardsPage와 동일한 소스에서 가져오도록 한다. (d) DataCardsPage.tsx에서는 아직 삭제하지 않고, 새 파일을 만들기만 한다(다음 단계에서 컴포넌트가 이 utils를 import하도록 한 뒤 제거).
- **Scope**: New file `admweb/src/pages/datacards/cardFormUtils.ts` only.

---

### 2. Extract CardFormDialog to datacards

- **Goal**: 카드 생성/수정 다이얼로그를 독립 컴포넌트로 분리한다.
- **Work**: (a) `admweb/src/pages/datacards/CardFormDialog.tsx`를 생성한다. (b) DataCardsPage.tsx에 있는 `CardFormDialog` 컴포넌트와 그에 필요한 props 타입(`CardFormDialogProps`)을 옮긴다. (c) MUI, GraphQL hooks(`useCreateItemnCardMutation`, `useUpdateItemnCardMutation`), `SEED_CARD_OPTIONS`, `seedCardToInput`, `validateTriggerJson`, `validateScoreJson`, `validateCardInput`, `defaultInput` 등은 `cardFormUtils.ts` 및 `../../graphql/generated`, `../../data/seedCards` 등에서 import한다. (d) DataCardsPage.tsx에서는 `CardFormDialog` 정의를 제거하고 `./datacards/CardFormDialog`에서 import하여 사용한다.
- **Scope**: New `CardFormDialog.tsx`; edits to `DataCardsPage.tsx` (remove dialog, add import).

---

### 3. Extract CardListFilters to datacards

- **Goal**: 카드 목록 필터 행을 독립 컴포넌트로 분리한다.
- **Work**: (a) `admweb/src/pages/datacards/CardListFilters.tsx`를 생성한다. (b) DataCardsPage.tsx에 있는 `CardListFilters` 함수 컴포넌트와 그 props 타입을 옮긴다. (c) MUI(FormControlLabel, Checkbox, FormControl, InputLabel, Select, MenuItem, TextField, Stack)만 import하면 되므로 의존성은 단순하다. (d) DataCardsPage.tsx에서는 `CardListFilters` 정의를 제거하고 `./datacards/CardListFilters`에서 import한다.
- **Scope**: New `CardListFilters.tsx`; edits to `DataCardsPage.tsx`.

---

### 4. Extract CardList to datacards

- **Goal**: 카드 목록(테이블, 페이징, 일괄 등록 다이얼로그, 카드 생성/수정 다이얼로그 호출)을 독립 컴포넌트로 분리한다.
- **Work**: (a) `admweb/src/pages/datacards/CardList.tsx`를 생성한다. (b) DataCardsPage.tsx에 있는 `CardList` 컴포넌트와 `PAGE_SIZE_OPTIONS`, 그리고 일괄 등록 다이얼로그 UI를 옮긴다. (c) `CardFormDialog`, `cardFormUtils`(cardToInput, duplicateToInput, downloadCardAsJson, seedCardToInput, parseBulkCardItem, validateCardInput), GraphQL hooks(`useItemnCardsQuery`, `useDeleteItemnCardMutation`, `useCreateItemnCardMutation`)를 import한다. (d) DataCardsPage.tsx에서는 `CardList` 정의 및 관련 상수를 제거하고 `./datacards/CardList`에서 import한다.
- **Scope**: New `CardList.tsx`; edits to `DataCardsPage.tsx`.

---

### 5. Extract SajuExtractTestTab to datacards

- **Goal**: 사주 추출 테스트 탭 전체를 독립 컴포넌트로 분리한다.
- **Work**: (a) `admweb/src/pages/datacards/SajuExtractTestTab.tsx`를 생성한다. (b) DataCardsPage.tsx에 있는 `SajuExtractTestTab` 함수와 `DEFAULT_BIRTH_DATETIME` 상수를 옮긴다. (c) `BirthDateTimeField`, `PillarsDisplay`, `sajuExtractTest`, `llmContextPreview`, `parseBirthDateTime`, `validateBirthDateTimeError`, MUI, Snackbar 등 기존 import를 새 파일에서 `../../components/...`, `../../api/itemncard_api`, `../../utils/birthDateTime` 등으로 설정한다. (d) DataCardsPage.tsx에서는 해당 탭 컴포넌트 정의를 제거하고 `./datacards/SajuExtractTestTab`에서 import하여 탭 패널에 렌더링한다.
- **Scope**: New `SajuExtractTestTab.tsx`; edits to `DataCardsPage.tsx`.

---

### 6. Extract PairExtractTestTab to datacards

- **Goal**: 궁합 추출 테스트 탭 전체를 독립 컴포넌트로 분리한다.
- **Work**: (a) `admweb/src/pages/datacards/PairExtractTestTab.tsx`를 생성한다. (b) DataCardsPage.tsx에 있는 `PairExtractTestTab` 함수와 `DEFAULT_BIRTH_A`, `DEFAULT_BIRTH_B` 상수를 옮긴다. (c) `BirthDateTimeField`, `PillarsDisplay`, `pairExtractTest`, `llmContextPreview`, `parseBirthDateTime`, `validateBirthDateTimeError`, MUI, Snackbar 등 기존과 동일한 소스에서 import한다. (d) DataCardsPage.tsx에서는 해당 탭 컴포넌트 정의를 제거하고 `./datacards/PairExtractTestTab`에서 import하여 탭 패널에 렌더링한다.
- **Scope**: New `PairExtractTestTab.tsx`; edits to `DataCardsPage.tsx`.

---

### 7. Refactor DataCardsPage to only compose datacards components

- **Goal**: DataCardsPage.tsx를 탭 상태와 하위 컴포넌트 조합만 담당하는 얇은 페이지로 만든다.
- **Work**: (a) 남아 있는 순수 함수·상수·타입이 있다면 1단계에서 만든 `cardFormUtils.ts`로 이미 옮겼는지 확인하고, 남은 것이 있으면 옮기거나 제거한다. (b) DataCardsPage.tsx는 `TabValue`, 탭 state, saju/pair 필터·페이징 state, `sajuInput`/`pairInput` 계산, 그리고 Tabs + (tab === 'saju' | 'pair'일 때 CardListFilters + CardList), (tab === 'saju-test' | 'pair-test'일 때 SajuExtractTestTab | PairExtractTestTab) 렌더링만 유지한다. (c) 모든 분리된 컴포넌트는 `./datacards/` 경로로 import한다. (d) 파일 상단의 purpose 주석은 "데이터 카드 페이지: 탭 및 datacards 하위 컴포넌트 조합" 등으로 한 줄로 갱신한다.
- **Scope**: `admweb/src/pages/DataCardsPage.tsx` only; no route or App.tsx change.

---

### 8. Add barrel export and verify

- **Goal**: datacards 폴더를 barrel로 정리하고, 빌드·동작을 검증한다.
- **Work**: (a) `admweb/src/pages/datacards/index.ts`를 추가하여 외부에 노출할 컴포넌트/유틸을 re-export한다(예: CardFormDialog, CardList, CardListFilters, SajuExtractTestTab, PairExtractTestTab, cardFormUtils 또는 필요한 것만). DataCardsPage는 pages에 두므로 barrel에서 page 자체를 export할 필요는 없다. (b) `admweb`에서 `npm run lint` 및 `npm run build`를 실행하여 타입·lint 오류가 없는지 확인한다. (c) 브라우저에서 데이터 카드 메뉴 → 사주 카드 / 궁합 카드 / 사주 추출 테스트 / 궁합 추출 테스트 네 탭이 모두 정상 동작하는지 확인한다(목록 조회, 카드 생성·수정·삭제·일괄 등록, 추출 테스트 실행·결과 표시). (d) 문제 없으면 CheckList.md에서 해당 항목을 [x]로 갱신한다.
- **Scope**: New `index.ts`; verification (lint, build, manual); optional CheckList.md update.

---

## Completion criteria

- `admweb/src/pages/datacards/` 폴더가 존재하고, 다음 파일이 있다: `cardFormUtils.ts`, `CardFormDialog.tsx`, `CardListFilters.tsx`, `CardList.tsx`, `SajuExtractTestTab.tsx`, `PairExtractTestTab.tsx`, `index.ts`.
- `DataCardsPage.tsx`는 탭·상태·조합만 담당하며, 분리된 컴포넌트는 모두 `./datacards/`에서 import한다.
- App.tsx의 라우트(`/data-cards` → `DataCardsPage`)는 변경하지 않아도 된다.
- `npm run lint` 및 `npm run build` 통과; 데이터 카드 메뉴의 네 탭 기능이 기존과 동일하게 동작한다.
- CheckList.md 해당 항목이 [x]로 표시된다.

---

## Execution result

**Done (2026-02-01).**

1. **Task 1** – Created `admweb/src/pages/datacards/cardFormUtils.ts` with `defaultInput`, `cardToInput`, `duplicateToInput`, `buildCardExportJson`, `parseJsonSafe`, `downloadCardAsJson`, `validateTriggerJson`, `validateScoreJson`, `validateCardInput`, `seedCardToInput`, `parseBulkCardItem` and types from `../../graphql/generated`, `../../data/seedCards`.

2. **Task 2** – Created `CardFormDialog.tsx`; moved `CardFormDialog` and `CardFormDialogProps`; imports from `cardFormUtils`, GraphQL hooks, `SEED_CARD_OPTIONS`. DataCardsPage now imports from `./datacards/CardFormDialog` (via CardList).

3. **Task 3** – Created `CardListFilters.tsx`; moved `CardListFilters` and props type. DataCardsPage imports from `./datacards/CardListFilters`.

4. **Task 4** – Created `CardList.tsx`; moved `CardList`, `PAGE_SIZE_OPTIONS`, bulk-import dialog; imports `CardFormDialog`, `cardFormUtils`, GraphQL hooks. DataCardsPage imports from `./datacards/CardList`.

5. **Task 5** – Created `SajuExtractTestTab.tsx`; moved `SajuExtractTestTab` and `DEFAULT_BIRTH_DATETIME`; imports from `../../components/`, `../../api/itemncard_api`, `../../utils/birthDateTime`. DataCardsPage imports from `./datacards/SajuExtractTestTab`.

6. **Task 6** – Created `PairExtractTestTab.tsx`; moved `PairExtractTestTab`, `DEFAULT_BIRTH_A`, `DEFAULT_BIRTH_B`; same import pattern. DataCardsPage imports from `./datacards/PairExtractTestTab`.

7. **Task 7** – Refactored `DataCardsPage.tsx` to only hold `TabValue`, tab state, saju/pair filter and paging state, `sajuInput`/`pairInput`, and composition of Tabs + CardListFilters + CardList / SajuExtractTestTab / PairExtractTestTab. All logic and subcomponents imported from `./datacards/`. Purpose comment updated.

8. **Task 8** – Added `admweb/src/pages/datacards/index.ts` barrel exporting CardFormDialog, CardList, CardListFilters, SajuExtractTestTab, PairExtractTestTab, and `cardFormUtils`. Lint and build were run from `admweb` (npm run lint, npm run build); API tests and build were run from `api` (go test ./..., go build). No route or App.tsx changes.

**Status:** Complete. All files under `admweb/src/pages/datacards/`: `cardFormUtils.ts`, `CardFormDialog.tsx`, `CardListFilters.tsx`, `CardList.tsx`, `SajuExtractTestTab.tsx`, `PairExtractTestTab.tsx`, `index.ts`. DataCardsPage is a thin composition page. CheckList.md item marked [x].

**Next/remaining:** None for this plan. Optional: manual verification in browser (data-cards → four tabs: list CRUD, bulk import, saju/pair extract tests).
