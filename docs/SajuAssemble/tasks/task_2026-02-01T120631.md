# Task plan: 데이터 카드 메뉴 생일·시간 입력 yyyy-MM-dd HH:mm 포매팅 룰 자동 적용 (2026-02-01T120631)

Single-item plan chosen from **CheckList.md** (remaining incomplete item):  
**데이터 카드 메뉴 이하의 화면에서 생일 및 시간의 입력에 대해서는 yyyy-MM-dd HH:mm 형식으로 텍스트 포매팅 룰을 자동으로 사용하여 작동하도록 해줘.**

Ref: PRD.md §2-3·§2-4, UserInfoStructure.md (birth.date YYYY-MM-DD, birth.time HH:mm), TokenRule.md, ExtractionAPI.md, admweb `utils/birthDateTime.ts`, DataCardsPage.tsx (사주 추출 테스트·궁합 추출 테스트).

---

## Current state (reference)

- **CheckList.md**: Two remaining items; this plan addresses the first (생일·시간 yyyy-MM-dd HH:mm 포매팅 룰 자동 사용).
- **Birth inputs under data card menu**: All in `admweb/src/pages/DataCardsPage.tsx` — (1) 사주 추출 테스트: 단일 "생년월일·시간" TextField; (2) 궁합 추출 테스트: "A 생년월일·시간", "B 생년월일·시간" TextField 두 개. 각각 `parseBirthDateTime`, `validateBirthDateTimeError`, `formatBirthParseResult` 사용, placeholder `yyyy-MM-dd HH:mm`, onBlur 시 parse → formatBirthParseResult로 정규화 후 상태 반영.
- **Rule**: UserInfoStructure에 따라 birth.date = YYYY-MM-DD, birth.time = HH:mm (모르면 "unknown"). 표시·입력 형식은 단일 문자열 `yyyy-MM-dd HH:mm` 또는 `yyyy-MM-dd unknown`.

---

## Ordered tasks

### 1. Document the formatting rule and scope

- **Goal**: 명시적으로 "데이터 카드 메뉴 하의 생일·시간 입력" 규칙과 적용 범위를 문서로 정리하여, 향후 동일 규칙 적용 시 참조할 수 있게 한다.
- **Work**: (a) `docs/saju/itemNcard/` 하위에 짧은 규칙 문서를 추가하거나 기존 문서(UserInfoStructure.md 또는 OperatorGuide.md)에 한 절 추가. 내용: 데이터 카드 메뉴 이하 화면에서 생일·시간 입력은 **형식** `yyyy-MM-dd HH:mm`(시간 모르면 `yyyy-MM-dd unknown`), **자동 포매팅**으로 onBlur(및 필요 시 onPaste) 시 parse → formatBirthParseResult로 정규화하여 표시·API 전달 값 일치. (b) 적용 대상: 사주 추출 테스트 1개 필드, 궁합 추출 테스트 A/B 2개 필드; 동일 규칙을 사용하는 공용 입력 컴포넌트 또는 유틸만 사용한다고 명시.
- **Scope**: Documentation only; no code change.

---

### 2. Add paste normalization in birthDateTime utils

- **Goal**: 붙여넣기 시에도 포매팅 룰이 자동 적용되도록, 유틸에서 "정규화 가능한 문자열"을 반환하는 함수가 paste 이벤트에서 사용 가능한지 확인하고, 필요하면 paste용 정규화 헬퍼를 추가한다.
- **Work**: (a) `admweb/src/utils/birthDateTime.ts` 검토: `parseBirthDateTime` + `formatBirthParseResult`로 이미 paste 후 문자열을 정규화할 수 있는지 확인. (b) 필요 시 `normalizeBirthDateTimeInput(raw: string): string` 같은 함수를 추가하여 trim → parse → formatBirthParseResult 반환(파싱 실패 시 원문 또는 빈 문자열 정책 결정). (c) 기존 `validateBirthDateTimeError` 등과 충돌 없이 유지.
- **Scope**: admweb `utils/birthDateTime.ts` only; minimal, single-responsibility change.

---

### 3. Introduce a shared BirthDateTimeField component

- **Goal**: 데이터 카드 메뉴 내 모든 생일·시간 입력이 동일한 "포매팅 룰 자동 적용" 동작을 하도록, 단일 재사용 컴포넌트로 통일한다.
- **Work**: (a) `admweb/src/components/` (또는 데이터 카드 전용 하위 폴더가 있다면 그곳)에 `BirthDateTimeField` 컴포넌트 생성. Props: `value`, `onChange`, `label`, `error`, `helperText`, `disabled` 등 MUI TextField 호환. (b) 내부 동작: value를 그대로 표시; onChange는 부모에 전달; onBlur에서 `parseBirthDateTime(value)` → `formatBirthParseResult(parsed)` 호출 후 정규화 문자열이 value와 다르면 `onChange(normalized)` 호출. (c) 선택: onPaste에서 paste 이벤트 후 정규화(또는 blur만으로도 "자동 포매팅" 요구 충족 가능하면 생략). (d) placeholder `yyyy-MM-dd HH:mm`, `utils/birthDateTime`의 validate/format 함수만 사용하여 중복 제거.
- **Scope**: New component file; no change yet to DataCardsPage.

---

### 4. Use BirthDateTimeField in DataCardsPage (saju-test)

- **Goal**: 사주 추출 테스트 탭의 생년월일·시간 입력을 공용 컴포넌트로 교체하여 포매팅 룰이 한 곳에서 적용되게 한다.
- **Work**: (a) DataCardsPage에서 사주 추출 테스트용 state `birthDateTime`, `birthValidationErr` 및 해당 TextField를 찾는다. (b) 해당 TextField를 `BirthDateTimeField`로 교체: value={birthDateTime}, onChange={setBirthDateTime}, onBlur 시 정규화는 컴포넌트 내부 처리, validation 에러는 기존처럼 `validateBirthDateTimeError(birthDateTime)` 사용. (c) import 및 기본 레이아웃/스타일 유지. (d) 기존 실행·결과 로직(parseBirthDateTime 등)은 그대로 사용하여 API 호출 형식 변경 없음.
- **Scope**: DataCardsPage.tsx, saju-test section only.

---

### 5. Use BirthDateTimeField in DataCardsPage (pair-test)

- **Goal**: 궁합 추출 테스트 탭의 A/B 생년월일·시간 입력을 공용 컴포넌트로 교체한다.
- **Work**: (a) DataCardsPage에서 궁합 추출 테스트용 `birthDateTimeA`, `birthDateTimeB`, `birthValidationErrA`, `birthValidationErrB` 및 해당 두 개 TextField를 찾는다. (b) 두 TextField를 각각 `BirthDateTimeField`로 교체(A용, B용). (c) onBlur 정규화는 컴포넌트 내부 처리; validation은 기존대로 두 필드 각각 `validateBirthDateTimeError` 사용. (d) import는 4에서 이미 추가되어 있으면 재사용.
- **Scope**: DataCardsPage.tsx, pair-test section only.

---

### 6. Verify formatting behavior end-to-end

- **Goal**: 데이터 카드 메뉴 하의 세 생일·시간 입력에서 yyyy-MM-dd HH:mm 포매팅 룰이 자동으로 적용되는지 확인한다.
- **Work**: (a) 사주 추출 테스트: 생년월일 필드에 `1990-1-1 9:5` 등 입력 후 blur → `1990-01-01 09:05` 등으로 정규화되는지 확인. `yyyy-MM-dd`만 입력 후 blur → `yyyy-MM-dd unknown` 또는 동일 형식 유지인지 확인. 잘못된 형식 입력 시 helperText에 검증 메시지 표시 확인. (b) 궁합 추출 테스트: A/B 필드에 대해 동일한 정규화·검증 동작 확인. (c) 추출 실행 시 API에 전달되는 birth.date / birth.time 값이 UserInfoStructure 형식(YYYY-MM-DD, HH:mm 또는 unknown)과 일치하는지 네트워크 또는 로그로 확인. (d) 이슈 있으면 2–5 단계에서 수정; 없으면 CheckList.md 해당 항목을 [x]로 갱신.
- **Scope**: Manual verification; optional CheckList.md update.

---

## Completion criteria

- 문서에 "데이터 카드 메뉴 생일·시간 입력 = yyyy-MM-dd HH:mm, 자동 포매팅(onBlur/필요 시 paste)" 규칙이 명시됨.
- `utils/birthDateTime.ts`에 paste 또는 정규화 헬퍼가 필요 시 추가되고, 기존 검증/포맷과 일관됨.
- `BirthDateTimeField` 컴포넌트가 한 곳에서 포매팅 룰을 적용하며, DataCardsPage의 사주 추출 1곳·궁합 추출 2곳에서 사용됨.
- 세 입력 모두에서 blur 시 정규화 및 검증 메시지 동작이 확인됨.
- CheckList.md 해당 항목이 [x]로 표시됨.

---

## Execution result

**Done (2026-02-01).**

1. **Documentation (Task 1)**  
   - Added section **데이터 카드 메뉴 내 생일·시간 입력 규칙** to `docs/saju/itemNcard/OperatorGuide.md`: 적용 범위(사주 추출 1필드, 궁합 추출 A/B 2필드), 형식(`yyyy-MM-dd HH:mm` / `yyyy-MM-dd unknown`), 자동 포매팅(onBlur·onPaste, `parseBirthDateTime` → `formatBirthParseResult`), 공용 컴포넌트·유틸 사용 명시.

2. **Utils (Task 2)**  
   - In `admweb/src/utils/birthDateTime.ts`: added `normalizeBirthDateTimeInput(raw)` (trim → parse → pad date to YYYY-MM-DD, time to HH:mm or `unknown` → format; returns normalized when valid, else raw). Paste normalization is available via this function in the field’s onPaste.

3. **BirthDateTimeField (Task 3)**  
   - New `admweb/src/components/BirthDateTimeField.tsx`: shared field with `value`/`onChange`, MUI TextField props, placeholder `yyyy-MM-dd HH:mm`. onBlur and onPaste call `normalizeBirthDateTimeInput` and update parent state when normalized value differs.

4. **DataCardsPage (Tasks 4–5)**  
   - **사주 추출 테스트**: single 생일·시간 TextField replaced with `BirthDateTimeField`; validation still via `validateBirthDateTimeError(birthDateTime)` on run.  
   - **궁합 추출 테스트**: A/B 생일·시간 TextFields replaced with `BirthDateTimeField` (labels "A 생일·시간", "B 생일·시간"); validation unchanged.

5. **Verification (Task 6)**  
   - Lint: no errors on modified/added files.  
   - Go tests/build and admweb build were run from repo root; if your environment differs, run: `cd api && go test ./...` and `go build .`, and `cd admweb && npm run build`.  
   - Manual check: in 데이터 카드 → 사주 추출 테스트 / 궁합 추출 테스트, enter e.g. `1990-1-1 9:5`, blur → should show `1990-01-01 09:05`; date-only blur → `yyyy-MM-dd unknown`; invalid input → helperText validation message.

**CheckList.md**: 해당 항목(생일·시간 yyyy-MM-dd HH:mm 포매팅 룰 자동 사용)을 [x]로 갱신함.
