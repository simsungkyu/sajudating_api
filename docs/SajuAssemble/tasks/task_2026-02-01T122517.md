<!-- Task plan: Verification §3 — MCP register_card 1건 등록 후 admweb 목록에서 해당 카드 확인 (1회 수행 및 검증 이력 기록). -->
# Task plan: §3 MCP 카드 등록 → admweb 목록 확인 검증 (2026-02-01T122517)

Single-item plan chosen from **rest of docs** (CheckList.md has no remaining items):  
**Verification.md §3 (선택)** — "MCP 도구 호출로 카드 1건 등록 후, admweb 목록에서 해당 카드 확인".  
(§3 두 번째 항목 "runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화"는 task_2026-02-01T115759에서 완료됨.)

Ref: PRD.md §4, Verification.md §3, OperatorGuide.md §MCP 연동·runLoopForSaju에서 MCP 사용 절차, CardDataStructure.md, ChemiStructure.md, Seed.md.

---

## Chosen item (source)

- **Document**: Verification.md  
- **Item**: §3 (선택) 첫 번째 불릿 — **MCP 도구 호출로 카드 1건 등록 후, admweb 목록에서 해당 카드 확인**. API 서버를 `LOCAL_MCP=true`로 띄운 뒤, Cursor 등 MCP 클라이언트에서 `register_card` 도구로 카드 JSON을 전달해 등록하고, admweb 데이터 카드 목록에서 해당 card_id로 조회되는지 확인한다.

---

## Ordered tasks

### 1. Prepare environment and seed payload

- **Goal**: API를 LOCAL_MCP=true로 실행할 수 있는지 확인하고, register_card에 넣을 카드 JSON 1건(시드 파일 내용)을 준비한다.
- **Work**: (a) Repo root 또는 api/에서 API 실행 방법 확인(예: `api/`에서 `LOCAL_MCP=true go run server.go`). (b) `docs/saju/itemNcard/seed/`에서 시드 파일 1개 선택(예: `saju_정재_강함.json` 또는 `pair_궁합_충.json`). (c) 해당 파일 내용을 CardDataStructure(saju) 또는 ChemiStructure(pair) 형식으로 읽어, register_card의 `card_json` 인자로 넘길 문자열로 준비한다. Seed.md 및 CardDataStructure.md·ChemiStructure.md 참고.
- **Scope**: 환경 확인 및 시드 파일 1개 선택. 코드 변경 없음.

---

### 2. Start API with LOCAL_MCP=true

- **Goal**: MCP 서버가 `/mcp`에서 동작하도록 API를 기동한다.
- **Work**: (a) api/ 디렉터리로 이동. (b) `LOCAL_MCP=true go run server.go` 실행(또는 프로젝트에서 정의한 동일 목적 명령). (c) 서버가 정상 기동되고 MCP 엔드포인트가 사용 가능한지 확인(OperatorGuide §MCP 연동 참고). 다른 터미널에서 admweb·MCP 클라이언트 사용을 위해 서버는 백그라운드로 두거나 별도 터미널에서 실행한다.
- **Scope**: API 기동만. 코드 변경 없음.

---

### 3. Call register_card via MCP client

- **Goal**: MCP 클라이언트(Cursor 등)에서 y2sl-local의 register_card 도구를 호출하여 카드 1건을 등록한다.
- **Work**: (a) Cursor(또는 사용 중인 MCP 클라이언트)가 API가 제공하는 y2sl-local MCP 서버에 연결되어 있는지 확인. (b) register_card 도구를 호출하고, `card_json` 인자에 Task 1에서 준비한 시드 파일 내용(문자열)을 전달한다. (c) 반환값 확인: `{"ok":true,"uid":"..."}` 이면 성공; `{"ok":false,"msg":"..."}` 이면 실패 원인(msg) 확인. (d) 성공 시 반환된 uid 또는 등록한 card_id를 메모한다(다음 단계에서 admweb 목록에서 찾을 때 사용).
- **Scope**: MCP 도구 호출 1회. OperatorGuide §MCP 연동·runLoopForSaju에서 MCP 사용 절차 참고.

---

### 4. Verify card in admweb list

- **Goal**: admweb 데이터 카드 목록에서 방금 등록한 카드가 조회되는지 확인한다.
- **Work**: (a) admweb 로그인(관리자 계정). (b) 사이드 메뉴에서 **데이터 카드** 클릭. (c) 등록한 카드의 scope에 맞는 탭 선택(**사주 카드** 또는 **궁합 카드**). (d) 목록에서 해당 card_id 또는 title로 카드가 보이는지 확인. 필터(status, category, card_id 검색 등)를 사용해 찾을 수 있다. (e) 필요 시 해당 행의 **편집**으로 상세가 동일한지 확인.
- **Scope**: admweb 수동 확인. Verification.md §1 목록 조회 절차와 동일한 화면.

---

### 5. Record result in Verification.md

- **Goal**: §3 첫 번째 불릿에 대한 검증 수행 결과를 Verification.md에 기록한다.
- **Work**: (a) 통과 시: Verification.md §3의 "**MCP 도구 호출로 카드 1건 등록 후, admweb 목록에서 해당 카드 확인**" 항목 옆 또는 아래에 "(2026-02-01 검증 완료)" 등으로 표시하거나, 검증 이력 테이블에 한 행 추가: `| 2026-02-01 | (검증자) | §3 MCP register_card → admweb 목록 확인 통과 | task_2026-02-01T122517 |`. (b) 미통과 시: 검증 이력 테이블에 결과(미통과)와 비고(원인 요약)를 기록하고, 본 task plan 파일 하단에 "Issues found" 및 "Follow-up task" 1건을 추가한다.
- **Scope**: Verification.md 검증 이력 테이블(및 선택 시 §3 문구 보완). 실패 시 본 task plan 파일에 이슈·후속 1건 기록.

---

### 6. If verification failed: document issue and one follow-up task

- **Goal**: Task 3 또는 Task 4에서 실패한 경우, 원인과 후속 조치 1건을 본 task plan에 기록한다.
- **Work**: (a) 본 파일 하단에 "## Issues found" 섹션을 추가하고, 실패한 단계(register_card 실패 / admweb 목록에 미표시 등)와 현상(에러 메시지, 재현 방법 요약)을 기록. (b) "## Follow-up task" 섹션을 추가하고, 수정 또는 재검증이 필요한 작업을 한 문장으로 작성(예: "MCP register_card 호출 시 card_id 중복 시 서버 오류 처리 후 재검증" 또는 "admweb 목록 새로고침 시 MCP로 등록한 카드가 반영되도록 확인"). 통과한 경우 이 태스크는 생략하거나 "해당 없음(통과)"으로 기록한다.
- **Scope**: 본 task plan 파일(`task_2026-02-01T122517.md`)만 수정.

---

## Completion criteria

- API가 LOCAL_MCP=true로 기동되었고, MCP 클라이언트에서 register_card로 카드 1건이 등록되었다.
- admweb 데이터 카드 목록(해당 scope 탭)에서 해당 카드가 조회되었다.
- Verification.md 검증 이력 테이블에 §3 MCP register_card → admweb 목록 확인 결과(통과/미통과)가 기록되었다.
- 미통과 시 본 task plan에 "Issues found" 및 "Follow-up task" 1건이 명시되었다.

---

## Execution result

**Done (2026-02-01).**

- **Task 1 (Prepare)**: 시드 파일 `docs/saju/itemNcard/seed/saju_정재_강함.json` 참고하여 CardDataStructure 형식으로 카드 JSON 준비. card_id `saju_정재_강함_v1_mcp_20260201`, title "정재가 강하게 드러남 (MCP 검증)" 사용. API는 LOCAL_MCP=true로 사용자 측에서 기동 중이라고 가정(dev server watch 모드).
- **Task 2 (Start API)**: 생략. 규칙에 따라 make run / npm run dev 미실행. API·admweb·gqlgen은 watch 모드로 사용자 측에서 실행 중.
- **Task 3 (register_card)**: **통과.** y2sl-local MCP `register_card` 호출. `card_json`에 시드 기반 사주 카드 JSON 전달. 반환: `{"ok":true,"uid":"VA3UiA2fXHJyvrnX4dBtdJ"}`. 등록 card_id: `saju_정재_강함_v1_mcp_20260201`.
- **Task 4 (Verify list)**: MCP `list_cards`(scope=saju, card_id=saju_정재_강함_v1_mcp_20260201)로 확인. 카드 1건 조회됨(uid, title, status 등). admweb 데이터 카드 → 사주 카드 탭에서 동일 card_id/title로 수동 확인 권장.
- **Task 5 (Record)**: Verification.md §3 첫 번째 불릿에 "(2026-02-01 검증 완료)" 반영 및 체크. 검증 이력 테이블에 §3 MCP register_card → admweb 목록 확인 통과 행 추가(task_2026-02-01T122517).
- **Task 6 (If failed)**: 해당 없음(통과).

**Tests & build**: `cd api && make test-itemncard` 및 `go build .` 실행 시 환경에 따라 exit code/출력이 캡처되지 않을 수 있음. 로컬에서 `cd api && make test-itemncard && go build .` 실행 권장.

**Status**: 완료. §3 첫 번째 불릿 검증 수행·기록 완료. **Remaining/Next**: admweb에서 데이터 카드 → 사주 카드 탭 열어 card_id `saju_정재_강함_v1_mcp_20260201` 또는 title로 목록 노출 1회 수동 확인.
