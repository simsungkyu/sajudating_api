# Task plan: Verification §3 — runLoopForSaju.sh 실행 시 MCP 카드 등록/갱신 절차 문서화·스크립트 반영 (2026-02-01T123451)

Single-item plan chosen from **docs/saju/itemNcard** (CheckList.md has no remaining items):  
**Verification.md §3** — "runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화 또는 스크립트 반영". Unchecked: OperatorGuide §MCP 연동 또는 PRD §4, runLoopForSaju.sh 주석/문서에 MCP 도구 호출 방법과 카드 JSON 전달 방식(시드 파일 또는 에이전트 생성 JSON)이 정리되어 있는지 확인.

Ref: PRD.md §4, Verification.md §3, OperatorGuide.md §MCP 연동·runLoopForSaju에서 MCP 사용 절차, runLoopForSaju.sh, setLoopEnvForSaju.sh.

---

## Current state (reference)

- **runLoopForSaju.sh**: Top comments (lines 3–6) reference LOCAL_MCP=true, y2sl-local MCP tools (register_card, update_card, list_cards), card JSON from seed or agent-generated, and OperatorGuide §runLoopForSaju에서 MCP 사용 절차.
- **setLoopEnvForSaju.sh**: EXECUTE_PROMPT includes a sentence to use y2sl-local MCP tools when the task plan involves creating/updating data cards; references runLoopForSaju.sh and OperatorGuide §MCP 연동.
- **OperatorGuide.md**: §MCP 연동 and §runLoopForSaju에서 MCP 사용 절차 describe steps (API LOCAL_MCP=true, MCP client, Phase 2 register_card/update_card/list_cards, card_json from seed or agent).
- **Verification.md §3**: One item checked (MCP register_card → admweb 목록 확인); one unchecked (runLoopForSaju.sh 절차 문서화 또는 스크립트 반영).

---

## Ordered tasks

### 1. Confirm script and env reference MCP procedure

- **Goal**: Verify runLoopForSaju.sh and setLoopEnvForSaju.sh explicitly reference MCP card registration/update procedure.
- **Work**: (a) Read runLoopForSaju.sh header: confirm comments mention LOCAL_MCP=true, register_card/update_card/list_cards, card JSON (seed or agent), and OperatorGuide §runLoopForSaju에서 MCP 사용 절차. (b) Read setLoopEnvForSaju.sh EXECUTE_PROMPT: confirm it tells the agent to use y2sl-local MCP tools when the task plan involves creating/updating data cards and points to OperatorGuide. (c) If either is missing a clear reference, note the gap for task 2.
- **Scope**: Read-only check; optional one-line note of gaps.

---

### 2. Add or tighten Phase 2 reminder (if gap from task 1)

- **Goal**: Ensure Phase 2 agent is explicitly reminded to use MCP for card create/update when the task plan involves cards.
- **Work**: Only if task 1 found a gap: (a) In setLoopEnvForSaju.sh, add or adjust one sentence in EXECUTE_PROMPT so it clearly says "When the task plan involves creating or updating data cards, use y2sl-local MCP tools (register_card, update_card, list_cards); card_json from docs/saju/itemNcard/seed/ or agent-generated JSON per CardDataStructure/ChemiStructure; see OperatorGuide §runLoopForSaju에서 MCP 사용 절차." (b) Or in runLoopForSaju.sh, add a one-line comment above the Phase 2 run_agent call that reminds to use MCP for card operations per OperatorGuide. Do not duplicate long procedure text; point to OperatorGuide. (c) If task 1 found no gap, skip this task.
- **Scope**: At most one of runLoopForSaju.sh or setLoopEnvForSaju.sh; minimal edit.

---

### 3. Confirm OperatorGuide §runLoopForSaju에서 MCP 사용 절차 is complete

- **Goal**: Verify OperatorGuide documents the steps an agent should follow when runLoopForSaju.sh Phase 2 involves cards.
- **Work**: (a) Open docs/saju/itemNcard/OperatorGuide.md, locate §runLoopForSaju에서 MCP 사용 절차. (b) Confirm it lists: (1) Run API with LOCAL_MCP=true; (2) MCP client connected; (3) In Phase 2, use register_card for new cards (card_json from seed file or agent-generated); (4) Use update_card with uid for updates; (5) Use list_cards to check before register/update. (c) If any step is missing or unclear, add one short sentence or bullet. (d) If already complete, no edit.
- **Scope**: OperatorGuide.md only; minimal edits if any.

---

### 4. Mark Verification.md §3 checklist and add verification log row

- **Goal**: Close the Verification §3 item and record the outcome.
- **Work**: (a) In docs/saju/itemNcard/Verification.md, in §3 "runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화 또는 스크립트 반영", change the checkbox from `- [ ]` to `- [x]` and optionally append a short note (e.g. "runLoopForSaju.sh·setLoopEnvForSaju.sh·OperatorGuide 확인 완료" or "task_2026-02-01T123451 반영"). (b) In the "검증 이력 (Execution log)" table, add one row: date 2026-02-01, 검증자 (task 실행), 결과 (e.g. "§3 runLoopForSaju MCP 절차 문서·스크립트 반영 확인"), 비고 (e.g. "task_2026-02-01T123451").
- **Scope**: Verification.md only; checkbox and one new table row.

---

## Summary

| Step | Description |
|------|-------------|
| 1 | Confirm runLoopForSaju.sh and setLoopEnvForSaju.sh reference MCP procedure; note any gap. |
| 2 | If gap: add or tighten one reminder in EXECUTE_PROMPT or runLoopForSaju.sh Phase 2 comment. |
| 3 | Confirm OperatorGuide §runLoopForSaju에서 MCP 사용 절차 lists all steps; minimal edit if needed. |
| 4 | Mark Verification.md §3 checklist item complete; add one 검증 이력 row. |

No backend or admweb code changes. Script/env/docs and Verification.md only. If CheckList.md had been updated by a previous task, do not change it in this plan.

---

## Execution result (2026-02-01)

**Done**
- **Task 1**: Confirmed runLoopForSaju.sh (lines 3–6) and setLoopEnvForSaju.sh (EXECUTE_PROMPT) explicitly reference LOCAL_MCP=true, register_card/update_card/list_cards, card JSON (seed or agent), and OperatorGuide §MCP 연동 · runLoopForSaju에서 MCP 사용 절차. No gap found.
- **Task 2**: Skipped (no gap from Task 1).
- **Task 3**: Confirmed OperatorGuide §runLoopForSaju에서 MCP 사용 절차 lists all five steps (API LOCAL_MCP=true; MCP client; Phase 2 register_card; update_card with uid; list_cards before register/update). No edit.
- **Task 4**: Verification.md §3 — changed the "runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화 또는 스크립트 반영" item from `- [ ]` to `- [x]` and appended note "runLoopForSaju.sh·setLoopEnvForSaju.sh·OperatorGuide 확인 완료 (task_2026-02-01T123451 반영)". Added one 검증 이력 row: 2026-02-01, (task 실행), §3 runLoopForSaju MCP 절차 문서·스크립트 반영 확인, task_2026-02-01T123451.

**Status**: All four tasks completed. Verification §3 checklist item and execution log updated.

**Tests/build**: No code changes this run. `go test ./...` and `go build .` were run from api/; exit codes in this environment were 1 with no captured output (environment/sandbox). Recommend running locally: `cd api && make test-itemncard && go build .`.

**Remaining/next**: None for this plan. CheckList.md was not modified (plan: "CheckList.md has no remaining items" / "do not change it in this plan").
