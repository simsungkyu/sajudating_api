<!-- itemNcard next-step task plan; ref PRD and itemNcard structure docs (CardDataStructure, ChemiStructure, TokenRule, etc). -->
# Task plan: itemNcard next steps (2026-02-01T051414)

Ordered task plan for itemNcard implementation. Ref: PRD.md, CardDataStructure, ChemiStructure, TokenRule, TokenStructure, UserInfoStructure. Only create/update this plan; do not implement code yet.

---

## Current state (as of 2026-02-01)

- **Backend**: Card CRUD (GraphQL), soft delete, extraction REST (saju: 인생/연도별/월별, pair). itemncard pipeline: pillars → items → tokens → card selection with evidence; domain/tag limits, cooldown_group, max_per_user. LLM context builder and POST `/api/adm/llm_context_preview`. AdminExtractService returns user/pair info + selected cards with evidence and score. y2sl-local MCP: `register_card`, `update_card`, `list_cards` in mcplocal/cardtools.go.
- **admweb**: Data Cards page with tabs (사주 카드, 궁합 카드, 사주 추출 테스트, 궁합 추출 테스트). List with filters, sort, paging; create/edit with full schema and trigger/score JSON validation (pair: src P|A|B). Soft delete, 복제, JSON 내보내기, 시드에서 불러오기 (9 options), 일괄 등록. Extract result: items/tokens summary, PillarDisplay (양=볼드, 오행=컬러), A/B 명식 요약, selected cards + expandable evidence; LLM 요청 전체 내용 textarea (saju/pair); copy-to-clipboard; LLM 컨텍스트 미리보기.
- **Docs**: ExtractionAPI.md, Seed.md (9 시드 옵션, 미참조 파일 정리), OperatorGuide.md, Verification.md (§6·§7 체크리스트, 전체 흐름 점검, 검증 이력·항목별 템플릿), TestScope.md (연도별/월별·동점 정렬 테스트 반영), 연도별_월별_pillar.md, run_verification.sh.
- **task_2026-02-01T050919** 완료: make test-itemncard 통과(DB 의존성 제거), Seed 참조·문서 정리, 검증 이력 템플릿, MCP·runLoop 문서화 확인, 추출 API 오류 처리 점검, TestScope 갱신.
- **Remaining**: 검증 담당자에 의한 §7 (1)~(5) 및 전체 흐름(사주 인생/연도별/월별, 궁합) 수동 점검 1회 후 이력 보완. PRD §7 (6) "전체적인 흐름·테스트 범위 확인" 미수행.

---

## Ordered next tasks

### 1. 검증 담당자 §7·전체 흐름 수동 점검 및 이력 기록

- **목표**: PRD §6 성공 기준 및 §7 (1)~(5) 검증 완료 상태를 검증 이력에 기록.
- **작업**: 검증 담당자가 Verification.md **§7 체크리스트** 5항목(원국 표시·A/B 명식·seed 참조·사주 LLM textarea·궁합 LLM textarea)과 **전체 흐름 점검**(사주 인생/연도별/월별, 궁합)을 1회 수행한 뒤, Verification.md **검증 이력** 테이블에 항목별 템플릿으로 통과/미통과와 날짜·검증자 기록. 발견 이슈가 있으면 별도 행으로 요약.
- **범위**: 문서만 갱신; 코드 변경 없음.

---

### 2. §7·전체 흐름 검증 중 발견 이슈 수정 (조건부)

- **목표**: Task 1 수행 중 발견된 이슈가 1건 이상 있을 때, 우선순위 높은 1건만 수정.
- **작업**: 검증 이력 또는 별도 기록에 정리된 이슈(표시 오류, 누락, 버그) 중 **1건**을 골라 구체적으로 수정(예: PillarDisplay·A/B 요약·evidence·textarea 표시). 이슈가 없거나 이미 별도 태스크로 정리된 경우 이 태스크는 "해당 없음"으로 생략.
- **범위**: 1건 수정에 그침.

---

### 3. PRD §7 (6) 흐름·테스트 범위 점검

- **목표**: PRD §7 (6) "전체적인 흐름에 이상한점은 없는지, 테스트는 적당한 로직과 범위로 수행되고 있는지 확인" 충족.
- **작업**: TestScope.md·Verification.md·실제 코드(api/service/itemncard, AdminExtractService, mcplocal)를 대조하여 **흐름**(입력→pillars→items→tokens→카드 선택→결과 반환)과 **테스트 범위**(Go 테스트 위치·커버 범위·수동 검증 항목)가 일치하는지 확인. 불일치 또는 누락 1~2건이 있으면 해당 문서에만 최소 보강(한두 문단 또는 표 한 행).
- **범위**: 점검 + 문서 최소 수정; 대규모 개편 없음.

---

### 4. run_verification.sh 사용법 문서화

- **목표**: 검증 수행 시 run_verification.sh 실행 방법을 한곳에 명시.
- **작업**: Verification.md "백엔드·빌드 검증" 또는 "검증 이력" 근처에 **run_verification.sh** 섹션을 추가: 실행 위치(repo root), 실행 명령(`./docs/saju/itemNcard/run_verification.sh` 또는 `bash docs/saju/itemNcard/run_verification.sh`), 목적(make test-itemncard + go build 수행, 검증 이력용 마크다운 한 줄 출력), 출력 해석 한두 문장. 기존 Verification.md에 이미 스크립트 언급이 있으면 그 섹션만 보강.
- **범위**: 문서만 갱신.

---

### 5. Seed 폴더·Seed.md 최종 대조

- **목표**: seed 폴더 내 파일과 Seed.md "Seed 파일 참조 현황"·미참조 목록이 최신 상태인지 유지.
- **작업**: `docs/saju/itemNcard/seed/` 디렉터리 목록과 Seed.md의 9개 시드 옵션·미참조 파일 표를 대조. 파일 추가/삭제로 인한 불일치가 있으면 Seed.md 표를 한두 행 갱신. 일괄 등록으로 나머지 시드 파일을 불러올 수 있다는 설명이 Verification §7 (3) 체크에 부합하는지 문구만 필요 시 보강.
- **범위**: 문서만; 코드 변경 없음.

---

### 6. 릴리스 전 확인 항목 정리

- **목표**: PRD §6·§7 충족 후 릴리스 전에 확인할 항목을 한곳에 정리.
- **작업**: Verification.md 또는 TestScope.md에 **릴리스 전 확인** 섹션(또는 기존 "백엔드·빌드 검증" 확장)을 추가: (1) `cd api && make test-itemncard` 통과, (2) `cd api && go build .` 성공, (3) admweb `npm run build` 성공(선택), (4) 검증 이력에 §7·전체 흐름 1회 기록 완료, (5) (선택) MCP 카드 등록·admweb 목록 확인. 3~5줄 요약으로 정리.
- **범위**: 문서만 갱신.

---

## Reference

| Doc | Use |
|-----|-----|
| PRD.md | §2 메뉴·화면, §2-4 선택 근거, §3 API, §4 y2sl-local MCP, §6 성공 기준, §7 추가 요청사항 |
| CardDataStructure.md | Card JSON, trigger (all/any/not), score, content, Step 4 정렬 |
| ChemiStructure.md | P_tokens, pair card schema, src P\|A\|B |
| TokenRule.md | items → tokens, where 정규화, L/M/H |
| TokenStructure.md | Token 문법, 카테고리, 위치 표준 |
| UserInfoStructure.md | user input, pillars, items[], tokens[], rule_set, engine_version |
| Verification.md | §6·§7 체크리스트, 전체 흐름 점검, 검증 이력 |
| TestScope.md | Go 테스트 위치, 커버 범위, 수동 검증 |
| Seed.md | Seed 파일 참조 현황, 시드에서 불러오기 옵션, 일괄 등록 |

---

## Notes

- Task 1: 검증 담당자 1회 수동 점검 후 Verification.md 이력 기록.
- Task 2: 발견 이슈 있을 때만 1건 수정; 없으면 생략.
- Task 3: PRD §7 (6) 흐름·테스트 범위 점검 및 문서 최소 보강.
- Task 4: run_verification.sh 사용법 문서화.
- Task 5: seed 폴더·Seed.md 표 대조 및 필요 시 한두 행 갱신.
- Task 6: 릴리스 전 확인 항목 3~5줄 요약.
- 모든 명령은 repo root 기준; 백엔드 검증은 `cd api && make test-itemncard` 등으로 수행.

---

## Execution result (2026-02-01)

**Done (agent)**

| Task | Status | What was done |
|------|--------|----------------|
| 1. 검증 담당자 §7·전체 흐름 수동 점검 | **대기** | 인간 검증 담당자 1회 수동 점검 필요. 문서·코드 변경 없음. |
| 2. 발견 이슈 1건 수정 (조건부) | **해당 없음** | Task 1 완료 전; 발견 이슈 없음. |
| 3. PRD §7 (6) 흐름·테스트 범위 점검 | **완료** | TestScope.md에 "흐름·테스트 범위 대조 (PRD §7 (6))" 문단 추가: 입력→pillars→items→tokens→카드 선택→결과 반환 흐름과 Go 테스트 위치·수동 검증 항목 대조 설명. |
| 4. run_verification.sh 사용법 문서화 | **완료** | Verification.md "백엔드·빌드 검증" 아래 **run_verification.sh** 섹션 추가: 실행 위치(repo root), 명령, 목적, 출력 해석. |
| 5. Seed 폴더·Seed.md 최종 대조 | **완료** | Seed.md: "위 6개" → "위 9개 옵션" 수정. 미참조 표 갱신: 십성(겁재 추가), 격국(편관격 추가), 용신(금·토·화 추가), 관계(파·해 추가), 육친(배우자·자녀·형제자매 추가), 궁합(갈등·성장·재정 추가). |
| 6. 릴리스 전 확인 항목 정리 | **완료** | Verification.md에 **릴리스 전 확인** 섹션 추가: (1) make test-itemncard 통과, (2) go build 성공, (3) admweb npm run build 선택, (4) §7·전체 흐름 1회 기록, (5) MCP·admweb 선택. |

**Verification (tests & build)**

- `cd api && make test-itemncard` 및 `cd api && go build .` 실행함. 본 실행 환경에서는 명령 출력이 캡처되지 않았음. 로컬에서 아래 명령으로 확인 권장: `cd api && make test-itemncard` 후 `go build .`. 실패 시 수정 후 재실행.

**Remaining / next steps**

1. **검증 담당자**: Verification.md §7 체크리스트 5항목 + 전체 흐름(사주 인생/연도별/월별, 궁합) 1회 수동 점검 후 검증 이력 테이블에 기록.
2. Task 1에서 이슈 발견 시 Task 2로 1건 수정.
3. 릴리스 전: Verification.md "릴리스 전 확인" 5항목 수행.
