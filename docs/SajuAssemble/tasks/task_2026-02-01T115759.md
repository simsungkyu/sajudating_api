<!-- Task plan: runLoopForSaju.sh MCP card registration/update procedure documentation (Verification §3, PRD §4). -->
# Task plan: runLoopForSaju.sh MCP 연동 절차 문서화 (2026-02-01T115759)

Single-item plan chosen from **docs/saju/itemNcard** (CheckList.md has no remaining items):  
**Verification.md §3** — runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화 또는 스크립트 반영.  
**PRD.md §4** — 구현 순서 3) runLoopForSaju.sh 등에서 agent가 해당 MCP를 사용하도록 프롬프트/설정 참조.

Ref: PRD.md §4, Verification.md §3, OperatorGuide.md §MCP 연동, runLoopForSaju.sh, setLoopEnvForSaju.sh, CardDataStructure.md, ChemiStructure.md, Seed.md.

---

## Current state (reference)

- **runLoopForSaju.sh**: Header comment (lines 3–5) mentions optional `LOCAL_MCP=true`, y2sl-local tools (`register_card`, `update_card`, `list_cards`), and refers to OperatorGuide.md §MCP 연동. No step-by-step procedure for using MCP during the loop.
- **OperatorGuide.md**: §MCP 연동 describes API `LOCAL_MCP=true`, tool summary (register_card, update_card, list_cards), and card JSON sources (seed file path vs agent-generated). One line mentions "Cursor CLI agent 또는 runLoopForSaju.sh 등에서 MCP 클라이언트로 위 도구를 호출해…".
- **Verification §3**: Requires (1) MCP 도구 호출로 카드 1건 등록 후 admweb 목록에서 확인; (2) runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차가 **문서화** 또는 **스크립트 반영**되어 있는지 확인.
- **setLoopEnvForSaju.sh**: Used by runLoopForSaju.sh for EXECUTE_PROMPT, PHASE1_PROMPT_BODY, INTERVAL. May optionally reference MCP usage for Phase 2.

---

## Ordered tasks

### 1. Add a "MCP card registration procedure" section to runLoopForSaju.sh or docs

- **Goal**: Anyone (or the agent) running runLoopForSaju.sh can follow a short procedure to use MCP for card registration/update.
- **Work**: Add a dedicated section either (A) at the top of `runLoopForSaju.sh` as an extended comment block (after the shebang and one-line description), or (B) as a new subsection under `docs/saju/itemNcard/OperatorGuide.md` §MCP 연동 titled e.g. "runLoopForSaju.sh에서 MCP 사용 절차". Content must include: (a) Start the API with `LOCAL_MCP=true` (e.g. from repo root: `LOCAL_MCP=true go run server.go` from `api/` or equivalent). (b) Ensure the MCP client (e.g. Cursor) is connected to the y2sl-local MCP server served by the API. (c) When executing task plans (Phase 2), use `register_card` to register new cards (card_json = seed file contents from `docs/saju/itemNcard/seed/` or agent-generated JSON per CardDataStructure/ChemiStructure). (d) Use `update_card` with `uid` and partial/full card JSON to update existing cards. (e) Use `list_cards` (scope, status, category, card_id, limit) to check existing cards before register/update. No script logic change; documentation only.
- **Scope**: runLoopForSaju.sh comment block and/or OperatorGuide.md. One place is enough if the other cross-references it.

---

### 2. Cross-reference runLoopForSaju.sh and OperatorGuide in both directions

- **Goal**: Verification §3 can confirm "runLoopForSaju.sh 주석/문서에 MCP 도구 호출 방법과 카드 JSON 전달 방식이 정리되어 있는지" by reading one place.
- **Work**: (a) In runLoopForSaju.sh, keep or add a line that points to OperatorGuide.md §MCP 연동 (and optionally PRD §4) for full tool semantics. (b) In OperatorGuide.md §MCP 연동, add one short paragraph or bullet list: "runLoopForSaju.sh 실행 시: API를 LOCAL_MCP=true로 띄운 뒤, Phase 2(태스크 실행)에서 에이전트가 MCP 도구 register_card/update_card/list_cards를 호출해 시드 파일 내용 또는 생성한 카드 JSON을 API에 반영할 수 있다. 자세한 절차는 runLoopForSaju.sh 상단 주석 또는 본 절 runLoopForSaju에서 MCP 사용 절차를 참고."
- **Scope**: Two small edits (runLoopForSaju.sh, OperatorGuide.md). No new files.

---

### 3. Optionally add EXECUTE_PROMPT or PHASE2 hint in setLoopEnvForSaju.sh

- **Goal**: When Phase 2 runs, the agent prompt can optionally remind the agent to use MCP for card registration/update when the task plan involves cards.
- **Work**: If `setLoopEnvForSaju.sh` exists and defines EXECUTE_PROMPT (or similar), add one optional sentence to the prompt body: e.g. "If the task plan involves creating or updating data cards, use the y2sl-local MCP tools (register_card, update_card, list_cards) with the API running under LOCAL_MCP=true; see runLoopForSaju.sh and OperatorGuide §MCP 연동." If the file does not exist or does not use such a variable, skip this task (no new file creation required).
- **Scope**: setLoopEnvForSaju.sh only if present and relevant. Otherwise mark "N/A" in execution notes.

---

### 4. Update Verification.md §3 checklist text for runLoopForSaju.sh

- **Goal**: Verification §3 item explicitly references the new procedure location so a reviewer knows where to look.
- **Work**: In `docs/saju/itemNcard/Verification.md`, in the bullet "runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화 또는 스크립트 반영", add a short parenthetical: e.g. "(runLoopForSaju.sh 상단 주석 또는 OperatorGuide §MCP 연동·runLoopForSaju에서 MCP 사용 절차 참고)." So the verification instruction is: confirm that document exists and describes MCP tool call method and card JSON passing (seed file or agent-generated).
- **Scope**: Verification.md one bullet only. No code changes.

---

### 5. Verification: confirm procedure is findable and complete

- **Goal**: Self-check that the procedure is in one findable place and includes MCP tool call method and card JSON passing (seed file or agent-generated JSON).
- **Work**: (a) Read runLoopForSaju.sh (and OperatorGuide §MCP if used). (b) Confirm the procedure mentions: starting API with LOCAL_MCP=true; register_card/update_card/list_cards; card JSON from seed file or agent-generated (CardDataStructure/ChemiStructure). (c) If anything is missing, add one or two sentences to the chosen doc. (d) Optionally add one row to Verification.md 검증 이력: date, "(task plan)" or "(task 실행)", "runLoopForSaju MCP 절차 문서화", "통과" or "문서 추가 완료".
- **Scope**: Read-through and minimal doc tweak; optional verification log row.

---

## Summary

| Step | Description |
|------|-------------|
| 1 | Add MCP card registration procedure (runLoopForSaju.sh comment block and/or OperatorGuide subsection). |
| 2 | Cross-reference runLoopForSaju.sh ↔ OperatorGuide §MCP 연동. |
| 3 | (Optional) Add EXECUTE_PROMPT hint in setLoopEnvForSaju.sh if present. |
| 4 | Update Verification.md §3 bullet to point to procedure location. |
| 5 | Confirm procedure is findable and complete; optional verification log row. |

No backend or API code changes. Only documentation and optional prompt hint so that runLoopForSaju.sh and Verification §3 are satisfied.

---

## Execution result (2026-02-01)

**Done**

1. **Task 1** — Added MCP card registration procedure in **OperatorGuide.md** §MCP 연동 as new subsection **runLoopForSaju.sh에서 MCP 사용 절차** (steps: API with LOCAL_MCP=true; MCP client connected; register_card for new cards; update_card with uid; list_cards before register/update). Updated **runLoopForSaju.sh** header comment to point to that subsection (and PRD §4).
2. **Task 2** — Cross-references in place: runLoopForSaju.sh points to OperatorGuide §MCP 연동 · runLoopForSaju에서 MCP 사용 절차; OperatorGuide §MCP 연동 now includes a short paragraph "runLoopForSaju.sh 실행 시: … 자세한 절차는 runLoopForSaju.sh 상단 주석 또는 본 절 runLoopForSaju에서 MCP 사용 절차를 참고."
3. **Task 3** — Added one sentence to **setLoopEnvForSaju.sh** EXECUTE_PROMPT: when the task plan involves creating or updating data cards, use y2sl-local MCP tools with LOCAL_MCP=true; see runLoopForSaju.sh and OperatorGuide §MCP 연동.
4. **Task 4** — Updated **Verification.md** §3 bullet "runLoopForSaju.sh 실행 시 MCP를 사용한 카드 등록/갱신 절차 문서화 또는 스크립트 반영" with parenthetical "(runLoopForSaju.sh 상단 주석 또는 OperatorGuide §MCP 연동·runLoopForSaju에서 MCP 사용 절차 참고)."
5. **Task 5** — Procedure is findable in OperatorGuide §MCP 연동 · runLoopForSaju에서 MCP 사용 절차 and covers LOCAL_MCP=true, register_card/update_card/list_cards, and card JSON (seed file or agent-generated). Added Verification.md 검증 이력 row: 2026-02-01, (task 실행), "runLoopForSaju MCP 절차 문서화", "문서 추가 완료".

**Status**: All tasks completed. Documentation-only; no API or backend code changed.

**Tests / build**: No code changes; `cd api && make test-itemncard` and `go build .` were not run in this environment (output not captured). Recommend running from repo root: `cd api && make test-itemncard` and `go build .` to confirm.

**CheckList.md**: Not updated — this task plan was for Verification §3 (runLoopForSaju MCP procedure documentation), not for a CheckList.md item. CheckList.md had no remaining items per plan.

**Remaining / next steps**: None. Verification §3 reviewer can confirm procedure location via runLoopForSaju.sh header or OperatorGuide §MCP 연동 · runLoopForSaju에서 MCP 사용 절차.
