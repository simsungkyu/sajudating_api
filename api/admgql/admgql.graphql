scalar BigInt

interface Node {
  id: ID
}
type KV {
  k: String!
  v: String!
}
input KVInput {
  k: String!
  v: String!
}

type SimpleResult {
  ok: Boolean!
  uid: String
  err: String
  msg: String
  value: String
  base64Value: String
  node: Node
  nodes: [Node!]
  kvs: [KV!]
  total: Int
  limit: Int
  offset: Int
}

type Query {
  sajuProfiles(input: SajuProfileSearchInput!): SimpleResult!
  sajuProfile(uid: String!): SimpleResult!
  sajuProfileSimilarPartners(
    uid: String!
    limit: Int!
    offset: Int!
  ): SimpleResult!
  phyIdealPartners(input: PhyIdealPartnerSearchInput!): SimpleResult!
  phyIdealPartner(uid: String!): SimpleResult!
  sajuProfileLogs(input: SajuProfileLogSearchInput!): SimpleResult!

  aiMetas(input: AiMetaSearchInput!): SimpleResult!
  aiMeta(uid: String!): SimpleResult!
  aiMetaTypes: SimpleResult!
  aiMetaKVs(input: AiMetaKVsInput!): SimpleResult! #kvs는 출력되는값
  aiExecutions(input: AiExecutionSearchInput!): SimpleResult!
  aiExecution(uid: String!): SimpleResult!
  palja(birthdate: String!, timezone: String!): SimpleResult!
}

type Mutation {
  # AdminUser
  login(email: String!, password: String!, otp: String!): SimpleResult! # 로그인 - 권한없이 가능
  logout: SimpleResult! # 로그아웃 - 로그인 권한 필요
  createAdminUser(email: String!, password: String!): SimpleResult! # 관리자 생성 join - 권한없이 가능
  setAdminUserActive(uid: String!, active: Boolean!): SimpleResult! # 관리자 활성화 비활성화 - 로그인 권한 필요
  updateAdminUser(
    uid: String!
    email: String!
    password: String!
  ): SimpleResult! # 관리자 정보 수정 - 로그인 권한 필요
  # SajuProfile
  createSajuProfile(input: SajuProfileCreateInput!): SimpleResult
  deleteSajuProfile(uid: String!): SimpleResult

  createPhyIdealPartner(input: PhyIdealPartnerCreateInput!): SimpleResult
  deletePhyIdealPartner(uid: String!): SimpleResult

  putAiMeta(input: AiMetaInput!): SimpleResult # AI Meta 생성 및 수정
  setAiMetaInUse(uid: String!): SimpleResult # AI Meta 사용 여부 설정
  delAiMeta(uid: String!): SimpleResult # AI Meta 삭제
  setAiMetaDefault(uid: String!): SimpleResult # AI Meta 기본 설정
  runAiExecution(input: AiExcutionInput!): SimpleResult!
}

type SajuProfile implements Node {
  id: ID
  uid: String!
  createdAt: BigInt!
  updatedAt: BigInt!
  sex: String!
  birthdate: String!
  palja: String!
  email: String!
  image: String! # base64 encoded image
  imageMimeType: String!
  nickname: String!
  #
  sajuSummary: String!
  sajuContent: String!
  #
  phySummary: String!
  phyContent: String!
  #
  myFeatureEyes: String!
  myFeatureNose: String!
  myFeatureMouth: String!
  myFeatureFaceShape: String!
  myFeatureNotes: String!
  #
  partnerEmbeddingText: String!
  partnerMatchTips: String!
  #
  partnerSummary: String!
  partnerFeatureEyes: String!
  partnerFeatureNose: String!
  partnerFeatureMouth: String!
  partnerFeatureFaceShape: String!
  partnerPersonalityMatch: String!
  partnerSex: String!
  partnerAge: Int!

  #
  phyPartnerUid: String!
  phyPartnerSimilarity: Float!
}

input SajuProfileSearchInput {
  limit: Int!
  offset: Int!
  orderBy: String
  orderDirection: String
}

input SajuProfileCreateInput {
  image: String! # base64 encoded image
  birthdate: String! # yyyymmddhhmm format (hhmm optional)
  sex: String!
}

# phy ideal partner
type PhyIdealPartner implements Node {
  id: ID
  uid: String!
  createdAt: BigInt!
  updatedAt: BigInt!
  # input
  summary: String!
  featureEyes: String!
  featureNose: String!
  featureMouth: String!
  featureFaceShape: String!
  personalityMatch: String!
  sex: String!
  age: Int!
  # Image Data (Generated or Uploaded)
  image: String!
  # Embedding
  embeddingModel: String!
  embeddingText: String!

  # 유사도
  similarityScore: Float!
  hasImage: Boolean!
}

input PhyIdealPartnerCreateInput {
  summary: String!
  featureEyes: String!
  featureNose: String!
  featureMouth: String!
  featureFaceShape: String!
  personalityMatch: String!
  sex: String!
  age: Int!
  image: String # base64 encoded image (optional)
}

input PhyIdealPartnerSearchInput {
  limit: Int!
  offset: Int!
  sex: String
  hasImage: Boolean
}

# Saju Profile Log
type SajuProfileLog implements Node {
  id: ID
  uid: String!
  createdAt: BigInt!
  updatedAt: BigInt!
  sajuUid: String!
  status: String!
  text: String!
}
input SajuProfileLogSearchInput {
  limit: Int!
  offset: Int!
  sajuUid: String!
  status: String
}

# ai meta
type AiMeta implements Node {
  id: ID
  uid: String!
  createdAt: BigInt!
  updatedAt: BigInt!
  metaType: String!

  name: String!
  desc: String!
  prompt: String!
  model: String!
  temperature: Float!
  maxTokens: Int!
  size: String! # 1024x1024, 2048x2048, 4096x4096 // 이미지 사이즈
  inUse: Boolean! # 사용 중인지 여부 (true: 사용 중, false: 사용 중이지 않음)
}

input AiMetaInput {
  uid: String # optional
  name: String!
  desc: String!
  prompt: String!
  metaType: String # Saju, FaceFeature, Phy, IdealPartnerImage
  model: String!
  temperature: Float!
  maxTokens: Int!
  size: String! # 1024x1024, 2048x2048, 4096x4096 // 이미지 사이즈
}

input AiMetaSearchInput {
  limit: Int!
  offset: Int!
  metaType: String # Saju, FaceFeature, Phy, IdealPartnerImage
  inUse: Boolean # 사용 중인지 여부 (true: 사용 중, false: 사용 중이지 않음)
}

# AI Excution
type AiExecution implements Node {
  id: ID
  uid: String!
  createdAt: BigInt!
  updatedAt: BigInt!
  metaUid: String!
  metaType: String!
  status: String!
  errorMessage: String!
  # real Request
  prompt: String!
  valued_prompt: String!
  inputkvs: [KV!]!
  outputkvs: [KV!]!
  model: String!
  temperature: Float!
  maxTokens: Int!
  size: String!
  inputImageBase64: String
  # result
  elapsedTime: Int!
  outputText: String
  outputImageBase64: String # if exists return base64 encoded image
  # usage
  inputTokens: Int!
  outputTokens: Int!
  totalTokens: Int!
  #
  runBy: String # admin, system
  runSajuProfileUid: String # saju profile uid
}

input AiExcutionInput {
  metaUid: String!
  metaType: String!
  promptType: String! # text, vision, image
  prompt: String! # 프롬프트
  valued_prompt: String! # params가 적용된 프롬프트
  inputkvs: [KVInput!]! # 입력값들
  outputkvs: [KVInput!]! # 출력값들
  model: String!
  temperature: Float!
  maxTokens: Int!
  size: String!

  inputImageBase64: String
}

input AiExecutionSearchInput {
  limit: Int!
  offset: Int!
  metaType: String
  metaUid: String
  runBy: String # admin, system
  runSajuProfileUid: String # saju profile uid
}

#
input AiMetaKVsInput {
  type: String! # Meta type
  kvs: [KVInput!]! # 메타에 따른 입력값들 - 사전정의됨
}

type AiMetaType implements Node {
  id: ID!
  type: String!
  inputFields: [String!]!
  outputFields: [String!]!
  hasInputImage: Boolean!
  hasOutputImage: Boolean!
}
